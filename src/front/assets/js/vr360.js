/* libpannellum.js */
window.libpannellum=(function(f,g,a){function c(H){var r=g.createElement("canvas");r.style.width=r.style.height="100%";H.appendChild(r);var k,s,t,C;var L;var B;var T;var D;var p,O,z;var K,m,P,S;var M;this.init=function(Z,af,X,ag,ah,Y,ab,ar){if(af===a){af="equirectangular"}if(af!="equirectangular"&&af!="cubemap"&&af!="multires"){console.log("Error: invalid image type specified!");throw {type:"config error"}}O=af;p=Z;z=X;M=ar||{};if(k){if(t){s.detachShader(k,t);s.deleteShader(t)}if(C){s.detachShader(k,C);s.deleteShader(C)}s.bindBuffer(s.ARRAY_BUFFER,null);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null);if(k.texture){s.deleteTexture(k.texture)}if(k.nodeCache){for(var ao=0;ao<k.nodeCache.length;ao++){s.deleteTexture(k.nodeCache[ao].texture)}}s.deleteProgram(k);k=a}D=a;var ai;if(!(O=="cubemap"&&(p[0].width&(p[0].width-1))!==0&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./)))){if(!s){s=r.getContext("experimental-webgl",{alpha:false,depth:false})}if(s&&s.getError()==1286){V()}}if(!s&&((O=="multires"&&p.hasOwnProperty("fallbackPath"))||O=="cubemap")&&("WebkitAppearance" in g.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||navigator.appVersion.indexOf("MSIE 10")!==-1)){if(B){H.removeChild(B)}B=g.createElement("div");B.className="pnlm-world";var aj;if(p.basePath){aj=p.basePath+p.fallbackPath}else{aj=p.fallbackPath}var aq=["f","r","b","l","u","d"];var an=0;var W=function(){var av=g.createElement("canvas");av.className="pnlm-face pnlm-"+aq[this.side]+"face";B.appendChild(av);var ax=av.getContext("2d");av.style.width=this.width+4+"px";av.style.height=this.height+4+"px";av.width=this.width+4;av.height=this.height+4;ax.drawImage(this,2,2);var az=ax.getImageData(0,0,av.width,av.height);var ay=az.data;var aw;var au;for(aw=2;aw<av.width-2;aw++){for(au=0;au<4;au++){ay[(aw+av.width)*4+au]=ay[(aw+av.width*2)*4+au];ay[(aw+av.width*(av.height-2))*4+au]=ay[(aw+av.width*(av.height-3))*4+au]}}for(aw=2;aw<av.height-2;aw++){for(au=0;au<4;au++){ay[(aw*av.width+1)*4+au]=ay[(aw*av.width+2)*4+au];ay[((aw+1)*av.width-2)*4+au]=ay[((aw+1)*av.width-3)*4+au]}}for(au=0;au<4;au++){ay[(av.width+1)*4+au]=ay[(av.width*2+2)*4+au];ay[(av.width*2-2)*4+au]=ay[(av.width*3-3)*4+au];ay[(av.width*(av.height-2)+1)*4+au]=ay[(av.width*(av.height-3)+2)*4+au];ay[(av.width*(av.height-1)-2)*4+au]=ay[(av.width*(av.height-2)-3)*4+au]}for(aw=1;aw<av.width-1;aw++){for(au=0;au<4;au++){ay[aw*4+au]=ay[(aw+av.width)*4+au];ay[(aw+av.width*(av.height-1))*4+au]=ay[(aw+av.width*(av.height-2))*4+au]}}for(aw=1;aw<av.height-1;aw++){for(au=0;au<4;au++){ay[(aw*av.width)*4+au]=ay[(aw*av.width+1)*4+au];ay[((aw+1)*av.width-1)*4+au]=ay[((aw+1)*av.width-2)*4+au]}}for(au=0;au<4;au++){ay[au]=ay[(av.width+1)*4+au];ay[(av.width-1)*4+au]=ay[(av.width*2-2)*4+au];ay[(av.width*(av.height-1))*4+au]=ay[(av.width*(av.height-2)+1)*4+au];ay[(av.width*av.height-1)*4+au]=ay[(av.width*(av.height-1)-2)*4+au]}ax.putImageData(az,0,0);an++;if(an==6){L=this.width;H.appendChild(B);ab()}};for(ai=0;ai<6;ai++){var al=new Image();al.crossOrigin=M.crossOrigin?M.crossOrigin:"anonymous";al.side=ai;al.onload=W;if(O=="multires"){al.src=encodeURI(aj.replace("%s",aq[ai])+"."+p.extension)}else{al.src=encodeURI(p[ai].src)}}return}else{if(!s){console.log("Error: no WebGL support detected!");throw {type:"no webgl"}}}if(p.basePath){p.fullpath=p.basePath+p.path}else{p.fullpath=p.path}p.invTileResolution=1/p.tileResolution;var ac=y();T=[];for(ai=0;ai<6;ai++){T[ai]=ac.slice(ai*12,ai*12+12);ac=y()}var ak,ap;if(O=="equirectangular"){ak=Math.max(p.width,p.height);ap=s.getParameter(s.MAX_TEXTURE_SIZE);if(ak>ap){console.log("Error: The image is too big; it's "+ak+"px wide, but this device's maximum supported width is "+ap+"px.");throw {type:"webgl size error",width:ak,maxWidth:ap}}}else{if(O=="cubemap"){ak=p[0].width;ap=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE);if(ak>ap){console.log("Error: The cube face image is too big; it's "+ak+"px wide, but this device's maximum supported width is "+ap+"px.");throw {type:"webgl size error",width:ak,maxWidth:ap}}}}if(ar!==a&&(ar.horizonPitch!==a||ar.horizonRoll!==a)){D=[ar.horizonPitch==a?0:ar.horizonPitch,ar.horizonRoll==a?0:ar.horizonRoll]}var ad=s.TEXTURE_2D;s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight);t=s.createShader(s.VERTEX_SHADER);var ae=i;if(O=="multires"){ae=e}s.shaderSource(t,ae);s.compileShader(t);C=s.createShader(s.FRAGMENT_SHADER);var at=h;if(O=="cubemap"){ad=s.TEXTURE_CUBE_MAP;at=j}else{if(O=="multires"){at=b}}s.shaderSource(C,at);s.compileShader(C);k=s.createProgram();s.attachShader(k,t);s.attachShader(k,C);s.linkProgram(k);if(!s.getShaderParameter(t,s.COMPILE_STATUS)){console.log(s.getShaderInfoLog(t))}if(!s.getShaderParameter(C,s.COMPILE_STATUS)){console.log(s.getShaderInfoLog(C))}if(!s.getProgramParameter(k,s.LINK_STATUS)){console.log(s.getProgramInfoLog(k))}s.useProgram(k);k.drawInProgress=false;k.texCoordLocation=s.getAttribLocation(k,"a_texCoord");s.enableVertexAttribArray(k.texCoordLocation);if(O!="multires"){if(!K){K=s.createBuffer()}s.bindBuffer(s.ARRAY_BUFFER,K);s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),s.STATIC_DRAW);s.vertexAttribPointer(k.texCoordLocation,2,s.FLOAT,false,0,0);k.aspectRatio=s.getUniformLocation(k,"u_aspectRatio");s.uniform1f(k.aspectRatio,s.drawingBufferWidth/s.drawingBufferHeight);k.psi=s.getUniformLocation(k,"u_psi");k.theta=s.getUniformLocation(k,"u_theta");k.f=s.getUniformLocation(k,"u_f");k.h=s.getUniformLocation(k,"u_h");k.v=s.getUniformLocation(k,"u_v");k.vo=s.getUniformLocation(k,"u_vo");k.rot=s.getUniformLocation(k,"u_rot");s.uniform1f(k.h,ag/(Math.PI*2));s.uniform1f(k.v,ah/Math.PI);s.uniform1f(k.vo,Y/Math.PI*2);if(O=="equirectangular"){k.backgroundColor=s.getUniformLocation(k,"u_backgroundColor");var am=ar.backgroundColor?ar.backgroundColor:[0,0,0];s.uniform4fv(k.backgroundColor,am.concat([1]))}k.texture=s.createTexture();s.bindTexture(ad,k.texture);if(O=="cubemap"){s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[1]);s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[3]);s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[4]);s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[5]);s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[0]);s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p[2])}else{s.texImage2D(ad,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p)}s.texParameteri(ad,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);s.texParameteri(ad,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);s.texParameteri(ad,s.TEXTURE_MIN_FILTER,s.LINEAR);s.texParameteri(ad,s.TEXTURE_MAG_FILTER,s.LINEAR)}else{k.vertPosLocation=s.getAttribLocation(k,"a_vertCoord");s.enableVertexAttribArray(k.vertPosLocation);if(!m){m=s.createBuffer()}if(!P){P=s.createBuffer()}if(!S){S=s.createBuffer()}s.bindBuffer(s.ARRAY_BUFFER,P);s.bufferData(s.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),s.STATIC_DRAW);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,S);s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),s.STATIC_DRAW);k.perspUniform=s.getUniformLocation(k,"u_perspMatrix");k.cubeUniform=s.getUniformLocation(k,"u_cubeMatrix");k.level=-1;k.currentNodes=[];k.nodeCache=[];k.nodeCacheTimestamp=0}var aa=s.getError();if(aa!==0){console.log("Error: Something went wrong with WebGL!",aa);throw {type:"webgl error"}}ab()};this.destroy=function(){if(H!==a){if(r!==a&&H.contains(r)){H.removeChild(r)}if(B!==a&&H.contains(B)){H.removeChild(B)}}if(s){var W=s.getExtension("WEBGL_lose_context");if(W){W.loseContext()}}};this.resize=function(){var W=f.devicePixelRatio||1;r.width=r.clientWidth*W;r.height=r.clientHeight*W;if(s){if(s.getError()==1286){V()}s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight);if(O!="multires"){s.uniform1f(k.aspectRatio,r.clientWidth/r.clientHeight)}}};this.resize();this.setPose=function(W,X){D=[W,X]};this.render=function(ak,an,ab,az){var aA,av,at,ay=0;if(az===a){az={}}if(az.roll){ay=az.roll}if(D!==a){var ac=D[0],ah=D[1];var Y=ak,Z=an,ao=Math.cos(ah)*Math.sin(ak)*Math.sin(ac)+Math.cos(ak)*(Math.cos(ac)*Math.cos(an)+Math.sin(ah)*Math.sin(ac)*Math.sin(an)),am=-Math.sin(ak)*Math.sin(ah)+Math.cos(ak)*Math.cos(ah)*Math.sin(an),aj=Math.cos(ah)*Math.cos(ac)*Math.sin(ak)+Math.cos(ak)*(-Math.cos(an)*Math.sin(ac)+Math.cos(ac)*Math.sin(ah)*Math.sin(an));ak=Math.asin(Math.max(Math.min(aj,1),-1));an=Math.atan2(am,ao);var ar=[Math.cos(Y)*(Math.sin(ah)*Math.sin(ac)*Math.cos(Z)-Math.cos(ac)*Math.sin(Z)),Math.cos(Y)*Math.cos(ah)*Math.cos(Z),Math.cos(Y)*(Math.cos(ac)*Math.sin(ah)*Math.cos(Z)+Math.sin(Z)*Math.sin(ac))],ap=[-Math.cos(ak)*Math.sin(an),Math.cos(ak)*Math.cos(an)];var ad=Math.acos(Math.max(Math.min((ar[0]*ap[0]+ar[1]*ap[1])/(Math.sqrt(ar[0]*ar[0]+ar[1]*ar[1]+ar[2]*ar[2])*Math.sqrt(ap[0]*ap[0]+ap[1]*ap[1])),1),-1));if(ar[2]<0){ad=2*Math.PI-ad}ay+=ad}if(!s&&(O=="multires"||O=="cubemap")){at=L/2;var al={f:"translate3d(-"+(at+2)+"px, -"+(at+2)+"px, -"+at+"px)",b:"translate3d("+(at+2)+"px, -"+(at+2)+"px, "+at+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(at+2)+"px, -"+at+"px, "+(at+2)+"px) rotateX(270deg)",d:"translate3d(-"+(at+2)+"px, "+at+"px, -"+(at+2)+"px) rotateX(90deg)",l:"translate3d(-"+at+"px, -"+(at+2)+"px, "+(at+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+at+"px, -"+(at+2)+"px, -"+(at+2)+"px) rotateY(270deg)"};aA=1/Math.tan(ab/2);var X=aA*s.drawingBufferWidth/2+"px";var aq="perspective("+X+") translateZ("+X+") rotateX("+ak+"rad) rotateY("+an+"rad) ";var aa=Object.keys(al);for(av=0;av<6;av++){var ai=B.querySelector(".pnlm-"+aa[av]+"face").style;ai.webkitTransform=aq+al[aa[av]];ai.transform=aq+al[aa[av]]}return}if(O!="multires"){var ag=2*Math.atan(Math.tan(ab*0.5)/(s.drawingBufferWidth/s.drawingBufferHeight));aA=1/Math.tan(ag*0.5);s.uniform1f(k.psi,an);s.uniform1f(k.theta,ak);s.uniform1f(k.rot,ay);s.uniform1f(k.f,aA);if(z===true){if(O=="equirectangular"){s.bindTexture(s.TEXTURE_2D,k.texture);s.texImage2D(s.TEXTURE_2D,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,p)}}s.drawArrays(s.TRIANGLES,0,6)}else{var W=o(ab,s.drawingBufferWidth/s.drawingBufferHeight,0.1,100);q(ab);var au=l();au=J(au,-ay,"z");au=J(au,-ak,"x");au=J(au,an,"y");au=G(au);s.uniformMatrix4fv(k.perspUniform,false,new Float32Array(u(W)));s.uniformMatrix4fv(k.cubeUniform,false,new Float32Array(u(au)));var af=Q(W,au);k.nodeCache.sort(N);if(k.nodeCache.length>200&&k.nodeCache.length>k.currentNodes.length+50){var aw=k.nodeCache.splice(200,k.nodeCache.length-200);for(var av=0;av<aw.length;av++){s.deleteTexture(aw[av].texture)}}k.currentNodes=[];var ax=["f","b","u","d","l","r"];for(at=0;at<6;at++){var ae=new n(T[at],ax[at],1,0,0,p.fullpath);A(af,ae,ak,an,ab)}k.currentNodes.sort(U);for(av=0;av<k.currentNodes.length;av++){if(!k.currentNodes[av].texture){setTimeout(w,0,k.currentNodes[av]);break}}F()}if(az.returnImage!==a){return r.toDataURL("image/png")}};this.isLoading=function(){if(s&&O=="multires"){for(var W=0;W<k.currentNodes.length;W++){if(!k.currentNodes[W].textureLoaded){return true}}}return false};this.getCanvas=function(){return r};function N(X,W){if(X.level==1&&W.level!=1){return -1}if(W.level==1&&X.level!=1){return 1}return W.timestamp-X.timestamp}function U(X,W){if(X.level!=W.level){return X.level-W.level}return X.diff-W.diff}function F(){if(!k.drawInProgress){k.drawInProgress=true;for(var W=0;W<k.currentNodes.length;W++){if(k.currentNodes[W].textureLoaded){s.bindBuffer(s.ARRAY_BUFFER,m);s.bufferData(s.ARRAY_BUFFER,new Float32Array(k.currentNodes[W].vertices),s.STATIC_DRAW);s.vertexAttribPointer(k.vertPosLocation,3,s.FLOAT,false,0,0);s.bindBuffer(s.ARRAY_BUFFER,P);s.vertexAttribPointer(k.texCoordLocation,2,s.FLOAT,false,0,0);s.bindTexture(s.TEXTURE_2D,k.currentNodes[W].texture);s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}}k.drawInProgress=false}}function n(X,Y,ab,W,aa,Z){this.vertices=X;this.side=Y;this.level=ab;this.x=W;this.y=aa;this.path=Z.replace("%s",Y).replace("%l",ab).replace("%x",W).replace("%y",aa)}function A(ac,au,af,ah,Y){if(v(ac,au.vertices)){var ak=au.vertices;var ai=ak[0]+ak[3]+ak[6]+ak[9];var ag=ak[1]+ak[4]+ak[7]+ak[10];var ae=ak[2]+ak[5]+ak[8]+ak[11];var al=Math.sqrt(ai*ai+ag*ag+ae*ae);var ad=Math.asin(ae/al);var W=Math.atan2(ag,ai);var Z=W-ah;Z+=(Z>Math.PI)?-2*Math.PI:(Z<-Math.PI)?2*Math.PI:0;Z=Math.abs(Z);au.diff=Math.acos(Math.sin(af)*Math.sin(ad)+Math.cos(af)*Math.cos(ad)*Math.cos(Z));var an=false;for(var aw=0;aw<k.nodeCache.length;aw++){if(k.nodeCache[aw].path==au.path){an=true;k.nodeCache[aw].timestamp=k.nodeCacheTimestamp++;k.nodeCache[aw].diff=au.diff;k.currentNodes.push(k.nodeCache[aw]);break}}if(!an){au.timestamp=k.nodeCacheTimestamp++;k.currentNodes.push(au);k.nodeCache.push(au)}if(au.level<k.level){var aB=p.cubeResolution*Math.pow(2,au.level-p.maxLevel);var aA=Math.ceil(aB*p.invTileResolution)-1;var aq=aB%p.tileResolution*2;var X=(aB*2)%p.tileResolution;if(X===0){X=p.tileResolution}if(aq===0){aq=p.tileResolution*2}var az=0.5;if(au.x==aA||au.y==aA){az=1-p.tileResolution/(p.tileResolution+X)}var ay=1-az;var aa=[];var aj,ab;var at=az,ap=az,am=az,av=ay,ar=ay,ao=ay;if(X<p.tileResolution){if(au.x==aA&&au.y!=aA){ap=0.5;ar=0.5;if(au.side=="d"||au.side=="u"){am=0.5;ao=0.5}}else{if(au.x!=aA&&au.y==aA){at=0.5;av=0.5;if(au.side=="l"||au.side=="r"){am=0.5;ao=0.5}}}}if(aq<=p.tileResolution){if(au.x==aA){at=0;av=1;if(au.side=="l"||au.side=="r"){am=0;ao=1}}if(au.y==aA){ap=0;ar=1;if(au.side=="d"||au.side=="u"){am=0;ao=1}}}aj=[ak[0],ak[1],ak[2],ak[0]*at+ak[3]*av,ak[1]*az+ak[4]*ay,ak[2]*am+ak[5]*ao,ak[0]*at+ak[6]*av,ak[1]*ap+ak[7]*ar,ak[2]*am+ak[8]*ao,ak[0]*az+ak[9]*ay,ak[1]*ap+ak[10]*ar,ak[2]*am+ak[11]*ao];ab=new n(aj,au.side,au.level+1,au.x*2,au.y*2,p.fullpath);aa.push(ab);if(!(au.x==aA&&aq<=p.tileResolution)){aj=[ak[0]*at+ak[3]*av,ak[1]*az+ak[4]*ay,ak[2]*am+ak[5]*ao,ak[3],ak[4],ak[5],ak[3]*az+ak[6]*ay,ak[4]*ap+ak[7]*ar,ak[5]*am+ak[8]*ao,ak[0]*at+ak[6]*av,ak[1]*ap+ak[7]*ar,ak[2]*am+ak[8]*ao];ab=new n(aj,au.side,au.level+1,au.x*2+1,au.y*2,p.fullpath);aa.push(ab)}if(!(au.x==aA&&aq<=p.tileResolution)&&!(au.y==aA&&aq<=p.tileResolution)){aj=[ak[0]*at+ak[6]*av,ak[1]*ap+ak[7]*ar,ak[2]*am+ak[8]*ao,ak[3]*az+ak[6]*ay,ak[4]*ap+ak[7]*ar,ak[5]*am+ak[8]*ao,ak[6],ak[7],ak[8],ak[9]*at+ak[6]*av,ak[10]*az+ak[7]*ay,ak[11]*am+ak[8]*ao];ab=new n(aj,au.side,au.level+1,au.x*2+1,au.y*2+1,p.fullpath);aa.push(ab)}if(!(au.y==aA&&aq<=p.tileResolution)){aj=[ak[0]*az+ak[9]*ay,ak[1]*ap+ak[10]*ar,ak[2]*am+ak[11]*ao,ak[0]*at+ak[6]*av,ak[1]*ap+ak[7]*ar,ak[2]*am+ak[8]*ao,ak[9]*at+ak[6]*av,ak[10]*az+ak[7]*ay,ak[11]*am+ak[8]*ao,ak[9],ak[10],ak[11]];ab=new n(aj,au.side,au.level+1,au.x*2,au.y*2+1,p.fullpath);aa.push(ab)}for(var ax=0;ax<aa.length;ax++){A(ac,aa[ax],af,ah,Y)}}}}function y(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function l(){return[1,0,0,0,1,0,0,0,1]}function J(W,Z,Y){var X=Math.sin(Z);var aa=Math.cos(Z);if(Y=="x"){return[W[0],aa*W[1]+X*W[2],aa*W[2]-X*W[1],W[3],aa*W[4]+X*W[5],aa*W[5]-X*W[4],W[6],aa*W[7]+X*W[8],aa*W[8]-X*W[7]]}if(Y=="y"){return[aa*W[0]-X*W[2],W[1],aa*W[2]+X*W[0],aa*W[3]-X*W[5],W[4],aa*W[5]+X*W[3],aa*W[6]-X*W[8],W[7],aa*W[8]+X*W[6]]}if(Y=="z"){return[aa*W[0]+X*W[1],aa*W[1]-X*W[0],W[2],aa*W[3]+X*W[4],aa*W[4]-X*W[3],W[5],aa*W[6]+X*W[7],aa*W[7]-X*W[6],W[8]]}}function G(W){return[W[0],W[1],W[2],0,W[3],W[4],W[5],0,W[6],W[7],W[8],0,0,0,0,1]}function u(W){return[W[0],W[4],W[8],W[12],W[1],W[5],W[9],W[13],W[2],W[6],W[10],W[14],W[3],W[7],W[11],W[15]]}function o(ab,Y,W,aa){var X=2*Math.atan(Math.tan(ab/2)*s.drawingBufferHeight/s.drawingBufferWidth);var Z=1/Math.tan(X/2);return[Z/Y,0,0,0,0,Z,0,0,0,0,(aa+W)/(W-aa),(2*aa*W)/(W-aa),0,0,-1,0]}function E(X,W){s.bindTexture(s.TEXTURE_2D,W);s.texImage2D(s.TEXTURE_2D,0,s.RGB,s.RGB,s.UNSIGNED_BYTE,X);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);s.bindTexture(s.TEXTURE_2D,null)}var I=(function(){var Z=4;var Y={};var ab=[];var X;function W(){var ae=this;this.texture=this.callback=null;this.image=new Image();this.image.crossOrigin=X?X:"anonymous";this.image.addEventListener("load",function(){E(ae.image,ae.texture);ae.callback(ae.texture);ad(ae)})}W.prototype.loadTexture=function(af,ae,ag){this.texture=ae;this.callback=ag;this.image.src=af};function ac(af,ae,ag){this.src=af;this.texture=ae;this.callback=ag}function ad(ae){if(ab.length){var af=ab.shift();ae.loadTexture(af.src,af.texture,af.callback)}else{Y[Z++]=ae}}for(var aa=0;aa<Z;aa++){Y[aa]=new W()}return function(ag,ah,af){X=af;var ae=s.createTexture();if(Z){Y[--Z].loadTexture(ag,ae,ah)}else{ab.push(new ac(ag,ae,ah))}return ae}})();function w(W){if(!W.textureLoad){W.textureLoad=true;I(encodeURI(W.path+"."+p.extension),function(X){W.texture=X;W.textureLoaded=true},M.crossOrigin)}}function q(X){var W=1;while(W<p.maxLevel&&s.drawingBufferWidth>p.tileResolution*Math.pow(2,W-1)*Math.tan(X/2)*0.707){W++}k.level=W}function Q(X,W){return[X[0]*W[0],X[0]*W[1],X[0]*W[2],0,X[5]*W[4],X[5]*W[5],X[5]*W[6],0,X[10]*W[8],X[10]*W[9],X[10]*W[10],X[11],-W[8],-W[9],-W[10],0]}function R(W,X){return[W[0]*X[0]+W[1]*X[1]+W[2]*X[2],W[4]*X[0]+W[5]*X[1]+W[6]*X[2],W[11]+W[8]*X[0]+W[9]*X[1]+W[10]*X[2],1/(W[12]*X[0]+W[13]*X[1]+W[14]*X[2])]}function x(W,aa){var Z=R(W,aa);var ac=Z[0]*Z[3];var Y=Z[1]*Z[3];var X=Z[2]*Z[3];var ab=[0,0,0];if(ac<-1){ab[0]=-1}if(ac>1){ab[0]=1}if(Y<-1){ab[1]=-1}if(Y>1){ab[1]=1}if(X<-1||X>1){ab[2]=1}return ab}function v(aa,ae){var Z=x(aa,ae.slice(0,3));var Y=x(aa,ae.slice(3,6));var X=x(aa,ae.slice(6,9));var W=x(aa,ae.slice(9,12));var ad=Z[0]+Y[0]+X[0]+W[0];if(ad==-4||ad==4){return false}var ac=Z[1]+Y[1]+X[1]+W[1];if(ac==-4||ac==4){return false}var ab=Z[2]+Y[2]+X[2]+W[2];return ab!=4}function V(){console.log("Reducing canvas size due to error 1286!");r.width=Math.round(r.width/2);r.height=Math.round(r.height/2)}}var i=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join("");var e=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join("");var d=["precision mediump float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);",].join("\n");var j=d+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n");var h=d+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else","gl_FragColor = texture2D(u_image, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}"].join("\n");var b=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(l,n,k,m){return new c(l,n,k,m)}}})(window,document);

/* imagesLoaded PACKAGED v4.1.4 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});

/* vr360 */
// var vr360ImgSrc = '/Auto/SANTAFE/variant/Active/';
var progressTimer;
// var vr360ImgSrc = '../../Auto/i10/';
var vr360ImgSrc = './assets/images/cars/';
var colors = ['Polar_White', 'Champion_Blue'];
var vrInfo = {
	// model: 'S1W7L6A1GDD473',
	direction: 0,
	startX: 0,
	startY: 0,
	beforeX: 0,
	beforeY: 0,
	currentColor: colors[0]
};
var pushSize = 10;

$(function(){
	vrInit();
	layoutSize();

	function vrInit() {
		var isLoaded = false;

		var $target = $('.vr-car-wrap');
		var $targetT = $target;
		var moveType = -1;
		
		var htDefaultOption = {
			moveThreshold: 6,
			slopeThreshold: 50,
		};

		var isStart = false;
		var isMove = false;
		var nVSlope = 0;
		var nHSlope = 0;
		var bSetSlope = false;
		var interval = interval ? 10 : 5;
		
		function initMoveInfo() {
			vrInfo.direction = 6;
			vrInfo.color = colors[0];
			vrInfo.startX = 0;
			vrInfo.startY = 0;
			vrInfo.beforeX = 0;
			vrInfo.beforeY = 0;
			vrInfo.currentColor = vrInfo.color;

			// pushDirection = 26 + vrInfo.direction

			// if (pushDirection > 36) {
			//     pushDirection = vrInfo.direction - 36;
			//     if (pushDirection < pushSize) vrInfo.direction;
			// }

			t = vrInfo.direction;
			if (t < 10) t = '0' + t;

			$target.find('.sequence').removeClass('on').eq(vrInfo.direction).addClass('on');
			$target.find('.sequence').eq(vrInfo.direction).append('<img src="'+ vr360ImgSrc + vrInfo.color +'/'+ vrInfo.color + '_' + t +'.png">');
		}
		
		// init
		initMoveInfo();
		
		$target.on('touchstart mousedown', function(e){
			if (isMobile) {
				if (e.type == 'mousedown') {
					return;
				}
			}

			if (!isLoaded) {
				return;
			}

			mRest();

			var htInfo = getMoveInfo(e);

			isStart = true;

			nStartX = htInfo.nX;
			nStartY = htInfo.nY;
			
			idx = vrInfo.direction +1;
			// idx = pushDirection +1;

			vrInfo.startX = htInfo.nX;
			vrInfo.startY = htInfo.nY;

			//console.log(vrInfo)
			$target.addClass('e-start');
		});
		
		if (!isMobile) {
			$targetT = $window;
		}

		$targetT.on('touchmove mousemove', function(e){
			if(!isStart){
				return;
			}

			isMove = true;

			var htInfo = getMoveInfo(e);
			
			vrInfo.beforeX = htInfo.nX;
			vrInfo.beforeY = htInfo.nY;
			
			if (moveType < 0 || moveType == 3 || moveType == 4) {
				moveType = getMoveType(htInfo.nX, htInfo.nY);
			}

			if (moveType == 0) {
				if (vrInfo.beforeX - interval > vrInfo.startX) {
					idx++;
					if (idx > 36) idx = 1;
					vrInfo.startX = vrInfo.beforeX;
				} else if (vrInfo.beforeX + interval < vrInfo.startX) {
					idx--;
					if (idx < 1) idx = 36;
					vrInfo.startX = vrInfo.beforeX;
				}
				vrInfo.direction = idx -1;
				$target.find('.sequence').removeClass('on').eq(vrInfo.direction).addClass('on');
				e.preventDefault();

			} else if (moveType == 1) {
				return;
			}

			if (getMoveType.nDis < htDefaultOption.moveThreshold) {
				return; 
			}

			$target.addClass('e-start');
		});
		
		$targetT.on('touchend mouseup', function(e){
			if (isMobile) {
				if (e.type == 'mouseup') {
					return;
				}
			}
			mRest();

			$target.removeClass('e-start');
		});

		function mRest(){
			isStart = false;
			isMove = false;
			moveType = -1;
		}

		function setSlope(e) {
			if (!bSetSlope) {
				nHSlope = ((window.innerHeight/2) / window.innerWidth).toFixed(2) * 1;
				nVSlope = (window.innerHeight / (window.innerWidth/2)).toFixed(2) * 1;
				
				return {
					nHSlope : nHSlope,
					nVSlope : nVSlope
				}
			}
		}
		
		function getMoveInfo(e) {
			var x = isMobile ? e.originalEvent.touches[0].pageX : e.offsetX;
			var y = isMobile ? e.originalEvent.touches[0].pageY : e.offsetY;
			
			return {
				nX : x,
				nY : y
			}
		}

		function getMoveType(x, y) {
			var nType = moveType;

			var nX = Math.abs(nStartX - x);
			var nY = Math.abs(nStartY - y);
			var nDis = nX + nY;
			
			if (htDefaultOption.slopeThreshold <= nDis) {
				var nSlope = parseFloat((nY/nX).toFixed(2),10);

				if(nSlope <= setSlope().nHSlope){
					nType = 0;
				}else if(nSlope >= setSlope().nVSlope){
					nType = 1;
				}else{
					nType = 2;
				}   
			}
			return nType;
		}
		
		$('.btn-vr360').on('click', vr360);
		$('.btn-left-prev, .btn-right-next').on('click', carMove);
		$('.exterior-color-chip').on('click', '.color-select', colorSelect);

		function vr360() {
			imagesProgress(vrInfo.model, vrInfo.direction, vrInfo.currentColor, 'btn-vr360');
			$('.vr360-wrap').addClass('is-loading');
			// $(this).hide();
		}

		function carMove() {
			if (!isLoaded) {
				return;
			}

			if ($(this).hasClass('btn-prev')) {
				idx = vrInfo.direction +1;
				idx--;
				if (idx < 1) idx = 36;
				vrInfo.direction = idx -1;
			}

			if ($(this).hasClass('btn-next')) {
				idx = vrInfo.direction +1;
				idx++;
				if (idx > 36) idx = 1;
				vrInfo.direction = idx -1;
			}

			$('.vr-car-wrap').find('.sequence').removeClass('on').eq(vrInfo.direction).addClass('on');
		}

		function colorSelect() {
			var $this = $(this);
			var idx = $this.parent().index();
			var $vr360 = $('.vr-car-wrap');
			var $noVr360 = $('.vr-car-no-img');
			var $btnVr360 = $('.btn-vr360');

			
			if ($this.hasClass('no-vr360')) {
				$vr360.hide();
				$noVr360.show();
				$btnVr360.hide();
			} else {
				$vr360.show();
				$noVr360.hide();
				
				vrInfo.currentColor = colors[idx];
				imagesProgress(vrInfo.model, vrInfo.direction, colors[idx], 'btn-color');
				$this.parent().addClass('is-active').siblings().removeClass('is-active');

				if (isLoaded) {
					$('.vr360-wrap').addClass('is-loading');
				} else {
					$btnVr360.show();
				}
			}
		}
		
		function imagesProgress(m, i, c, v) {
			var $target = $('.vr360-wrap');
			var $sequence = $target.find('.sequence');
			var $progressBar = $target.find('.progress > .bar');
			var $progressText = $target.find('.progress > .count');
			
			var idx = i;
			var total = 36;
		
			initProgress();
			
			if (v == 'btn-vr360') {
				isLoaded = true;
				$target.find('.sequence').empty();
				for (var i=0; i<=total; i++) {
					t = i;
					if (t < 10) t = '0' + t;

					$target.find('.sequence[data-sequence='+ i +']').append('<img src="' + vr360ImgSrc + c +'/'+ c + '_' + t +'.png" alt="">');
				}
			}
		
			if (v == 'btn-color') {
				if (isLoaded) {
					for (var i=0; i<=total; i++) {
						t = i;
						if (t < 10) t = '0' + t;

						$target.find('.sequence[data-sequence='+ i +']').find('img').attr('src', vr360ImgSrc + c +'/'+ c + '_' + t +'.png');
					}
				} else {
					t = i;
					if (t < 10) t = '0' + t;
					
					$target.find('.sequence[data-sequence='+ i +']').find('img').attr('src', vr360ImgSrc + c +'/'+ c + '_' + t +'.png');
				}
			}
			
			if (!isLoaded) {
				return;
			}

			var $target = $('.vr360-wrap');
			var $imgLoad = imagesLoaded('.vr360-wrap'),
				imgTotal = $imgLoad.images.length,
				imgLoaded = 0,
				current = 0;

				clearInterval(progressTimer);
				progressTimer = setInterval(updateProgress, 1000 / 60);
				
				$imgLoad.on('progress', function(){
					imgLoaded++;
				});
		
			function updateProgress() {
				var target = (imgLoaded / imgTotal) * 100;
					current += (target - current) * 0.1;

				if (current >= 99.9) {
					current = 100;
				}

				if (current >= 100) {
					clearInterval(progressTimer);
					$progressBar.add($progressText).stop().animate({ opacity:0 }, 0, function(){
						$('.vr360-wrap').removeClass('is-loading');
						$('.vr360-wrap').addClass('progress-complete');
						$('.vr360-wrap').find('.vr-car-wrap').addClass('move');
					});
				}

				$progressBar.css({ width: current + '%' });
				$progressText.css('opacity', '1').text( Math.floor(current) +  '%' );
			}
		
			function initProgress() {
				$target.removeClass('progress-complete');
				$target.find('.vr-car-wrap').removeClass('move');
				$progressBar.css({'width': '0%', 'opacity': '1'});
				$progressText.css('opacity', '0').html('0%');
			}
		}
	}
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJmcm9udC9hc3NldHMvanMvdnIzNjAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogbGlicGFubmVsbHVtLmpzICovXHJcbndpbmRvdy5saWJwYW5uZWxsdW09KGZ1bmN0aW9uKGYsZyxhKXtmdW5jdGlvbiBjKEgpe3ZhciByPWcuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtyLnN0eWxlLndpZHRoPXIuc3R5bGUuaGVpZ2h0PVwiMTAwJVwiO0guYXBwZW5kQ2hpbGQocik7dmFyIGsscyx0LEM7dmFyIEw7dmFyIEI7dmFyIFQ7dmFyIEQ7dmFyIHAsTyx6O3ZhciBLLG0sUCxTO3ZhciBNO3RoaXMuaW5pdD1mdW5jdGlvbihaLGFmLFgsYWcsYWgsWSxhYixhcil7aWYoYWY9PT1hKXthZj1cImVxdWlyZWN0YW5ndWxhclwifWlmKGFmIT1cImVxdWlyZWN0YW5ndWxhclwiJiZhZiE9XCJjdWJlbWFwXCImJmFmIT1cIm11bHRpcmVzXCIpe2NvbnNvbGUubG9nKFwiRXJyb3I6IGludmFsaWQgaW1hZ2UgdHlwZSBzcGVjaWZpZWQhXCIpO3Rocm93IHt0eXBlOlwiY29uZmlnIGVycm9yXCJ9fU89YWY7cD1aO3o9WDtNPWFyfHx7fTtpZihrKXtpZih0KXtzLmRldGFjaFNoYWRlcihrLHQpO3MuZGVsZXRlU2hhZGVyKHQpfWlmKEMpe3MuZGV0YWNoU2hhZGVyKGssQyk7cy5kZWxldGVTaGFkZXIoQyl9cy5iaW5kQnVmZmVyKHMuQVJSQVlfQlVGRkVSLG51bGwpO3MuYmluZEJ1ZmZlcihzLkVMRU1FTlRfQVJSQVlfQlVGRkVSLG51bGwpO2lmKGsudGV4dHVyZSl7cy5kZWxldGVUZXh0dXJlKGsudGV4dHVyZSl9aWYoay5ub2RlQ2FjaGUpe2Zvcih2YXIgYW89MDthbzxrLm5vZGVDYWNoZS5sZW5ndGg7YW8rKyl7cy5kZWxldGVUZXh0dXJlKGsubm9kZUNhY2hlW2FvXS50ZXh0dXJlKX19cy5kZWxldGVQcm9ncmFtKGspO2s9YX1EPWE7dmFyIGFpO2lmKCEoTz09XCJjdWJlbWFwXCImJihwWzBdLndpZHRoJihwWzBdLndpZHRoLTEpKSE9PTAmJihuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkubWF0Y2goLyhpcGhvbmV8aXBvZHxpcGFkKS4qIG9zIDhfLyl8fG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5tYXRjaCgvKGlwaG9uZXxpcG9kfGlwYWQpLiogb3MgOV8vKXx8bmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLm1hdGNoKC8oaXBob25lfGlwb2R8aXBhZCkuKiBvcyAxMF8vKXx8bmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVHJpZGVudC4qcnZbIDpdKjExXFwuLykpKSl7aWYoIXMpe3M9ci5nZXRDb250ZXh0KFwiZXhwZXJpbWVudGFsLXdlYmdsXCIse2FscGhhOmZhbHNlLGRlcHRoOmZhbHNlfSl9aWYocyYmcy5nZXRFcnJvcigpPT0xMjg2KXtWKCl9fWlmKCFzJiYoKE89PVwibXVsdGlyZXNcIiYmcC5oYXNPd25Qcm9wZXJ0eShcImZhbGxiYWNrUGF0aFwiKSl8fE89PVwiY3ViZW1hcFwiKSYmKFwiV2Via2l0QXBwZWFyYW5jZVwiIGluIGcuZG9jdW1lbnRFbGVtZW50LnN0eWxlfHxuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50LipydlsgOl0qMTFcXC4vKXx8bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZihcIk1TSUUgMTBcIikhPT0tMSkpe2lmKEIpe0gucmVtb3ZlQ2hpbGQoQil9Qj1nLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7Qi5jbGFzc05hbWU9XCJwbmxtLXdvcmxkXCI7dmFyIGFqO2lmKHAuYmFzZVBhdGgpe2FqPXAuYmFzZVBhdGgrcC5mYWxsYmFja1BhdGh9ZWxzZXthaj1wLmZhbGxiYWNrUGF0aH12YXIgYXE9W1wiZlwiLFwiclwiLFwiYlwiLFwibFwiLFwidVwiLFwiZFwiXTt2YXIgYW49MDt2YXIgVz1mdW5jdGlvbigpe3ZhciBhdj1nLmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7YXYuY2xhc3NOYW1lPVwicG5sbS1mYWNlIHBubG0tXCIrYXFbdGhpcy5zaWRlXStcImZhY2VcIjtCLmFwcGVuZENoaWxkKGF2KTt2YXIgYXg9YXYuZ2V0Q29udGV4dChcIjJkXCIpO2F2LnN0eWxlLndpZHRoPXRoaXMud2lkdGgrNCtcInB4XCI7YXYuc3R5bGUuaGVpZ2h0PXRoaXMuaGVpZ2h0KzQrXCJweFwiO2F2LndpZHRoPXRoaXMud2lkdGgrNDthdi5oZWlnaHQ9dGhpcy5oZWlnaHQrNDtheC5kcmF3SW1hZ2UodGhpcywyLDIpO3ZhciBhej1heC5nZXRJbWFnZURhdGEoMCwwLGF2LndpZHRoLGF2LmhlaWdodCk7dmFyIGF5PWF6LmRhdGE7dmFyIGF3O3ZhciBhdTtmb3IoYXc9Mjthdzxhdi53aWR0aC0yO2F3Kyspe2ZvcihhdT0wO2F1PDQ7YXUrKyl7YXlbKGF3K2F2LndpZHRoKSo0K2F1XT1heVsoYXcrYXYud2lkdGgqMikqNCthdV07YXlbKGF3K2F2LndpZHRoKihhdi5oZWlnaHQtMikpKjQrYXVdPWF5Wyhhdythdi53aWR0aCooYXYuaGVpZ2h0LTMpKSo0K2F1XX19Zm9yKGF3PTI7YXc8YXYuaGVpZ2h0LTI7YXcrKyl7Zm9yKGF1PTA7YXU8NDthdSsrKXtheVsoYXcqYXYud2lkdGgrMSkqNCthdV09YXlbKGF3KmF2LndpZHRoKzIpKjQrYXVdO2F5WygoYXcrMSkqYXYud2lkdGgtMikqNCthdV09YXlbKChhdysxKSphdi53aWR0aC0zKSo0K2F1XX19Zm9yKGF1PTA7YXU8NDthdSsrKXtheVsoYXYud2lkdGgrMSkqNCthdV09YXlbKGF2LndpZHRoKjIrMikqNCthdV07YXlbKGF2LndpZHRoKjItMikqNCthdV09YXlbKGF2LndpZHRoKjMtMykqNCthdV07YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMikrMSkqNCthdV09YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMykrMikqNCthdV07YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMSktMikqNCthdV09YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMiktMykqNCthdV19Zm9yKGF3PTE7YXc8YXYud2lkdGgtMTthdysrKXtmb3IoYXU9MDthdTw0O2F1Kyspe2F5W2F3KjQrYXVdPWF5Wyhhdythdi53aWR0aCkqNCthdV07YXlbKGF3K2F2LndpZHRoKihhdi5oZWlnaHQtMSkpKjQrYXVdPWF5Wyhhdythdi53aWR0aCooYXYuaGVpZ2h0LTIpKSo0K2F1XX19Zm9yKGF3PTE7YXc8YXYuaGVpZ2h0LTE7YXcrKyl7Zm9yKGF1PTA7YXU8NDthdSsrKXtheVsoYXcqYXYud2lkdGgpKjQrYXVdPWF5Wyhhdyphdi53aWR0aCsxKSo0K2F1XTtheVsoKGF3KzEpKmF2LndpZHRoLTEpKjQrYXVdPWF5WygoYXcrMSkqYXYud2lkdGgtMikqNCthdV19fWZvcihhdT0wO2F1PDQ7YXUrKyl7YXlbYXVdPWF5Wyhhdi53aWR0aCsxKSo0K2F1XTtheVsoYXYud2lkdGgtMSkqNCthdV09YXlbKGF2LndpZHRoKjItMikqNCthdV07YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMSkpKjQrYXVdPWF5Wyhhdi53aWR0aCooYXYuaGVpZ2h0LTIpKzEpKjQrYXVdO2F5Wyhhdi53aWR0aCphdi5oZWlnaHQtMSkqNCthdV09YXlbKGF2LndpZHRoKihhdi5oZWlnaHQtMSktMikqNCthdV19YXgucHV0SW1hZ2VEYXRhKGF6LDAsMCk7YW4rKztpZihhbj09Nil7TD10aGlzLndpZHRoO0guYXBwZW5kQ2hpbGQoQik7YWIoKX19O2ZvcihhaT0wO2FpPDY7YWkrKyl7dmFyIGFsPW5ldyBJbWFnZSgpO2FsLmNyb3NzT3JpZ2luPU0uY3Jvc3NPcmlnaW4/TS5jcm9zc09yaWdpbjpcImFub255bW91c1wiO2FsLnNpZGU9YWk7YWwub25sb2FkPVc7aWYoTz09XCJtdWx0aXJlc1wiKXthbC5zcmM9ZW5jb2RlVVJJKGFqLnJlcGxhY2UoXCIlc1wiLGFxW2FpXSkrXCIuXCIrcC5leHRlbnNpb24pfWVsc2V7YWwuc3JjPWVuY29kZVVSSShwW2FpXS5zcmMpfX1yZXR1cm59ZWxzZXtpZighcyl7Y29uc29sZS5sb2coXCJFcnJvcjogbm8gV2ViR0wgc3VwcG9ydCBkZXRlY3RlZCFcIik7dGhyb3cge3R5cGU6XCJubyB3ZWJnbFwifX19aWYocC5iYXNlUGF0aCl7cC5mdWxscGF0aD1wLmJhc2VQYXRoK3AucGF0aH1lbHNle3AuZnVsbHBhdGg9cC5wYXRofXAuaW52VGlsZVJlc29sdXRpb249MS9wLnRpbGVSZXNvbHV0aW9uO3ZhciBhYz15KCk7VD1bXTtmb3IoYWk9MDthaTw2O2FpKyspe1RbYWldPWFjLnNsaWNlKGFpKjEyLGFpKjEyKzEyKTthYz15KCl9dmFyIGFrLGFwO2lmKE89PVwiZXF1aXJlY3Rhbmd1bGFyXCIpe2FrPU1hdGgubWF4KHAud2lkdGgscC5oZWlnaHQpO2FwPXMuZ2V0UGFyYW1ldGVyKHMuTUFYX1RFWFRVUkVfU0laRSk7aWYoYWs+YXApe2NvbnNvbGUubG9nKFwiRXJyb3I6IFRoZSBpbWFnZSBpcyB0b28gYmlnOyBpdCdzIFwiK2FrK1wicHggd2lkZSwgYnV0IHRoaXMgZGV2aWNlJ3MgbWF4aW11bSBzdXBwb3J0ZWQgd2lkdGggaXMgXCIrYXArXCJweC5cIik7dGhyb3cge3R5cGU6XCJ3ZWJnbCBzaXplIGVycm9yXCIsd2lkdGg6YWssbWF4V2lkdGg6YXB9fX1lbHNle2lmKE89PVwiY3ViZW1hcFwiKXthaz1wWzBdLndpZHRoO2FwPXMuZ2V0UGFyYW1ldGVyKHMuTUFYX0NVQkVfTUFQX1RFWFRVUkVfU0laRSk7aWYoYWs+YXApe2NvbnNvbGUubG9nKFwiRXJyb3I6IFRoZSBjdWJlIGZhY2UgaW1hZ2UgaXMgdG9vIGJpZzsgaXQncyBcIithaytcInB4IHdpZGUsIGJ1dCB0aGlzIGRldmljZSdzIG1heGltdW0gc3VwcG9ydGVkIHdpZHRoIGlzIFwiK2FwK1wicHguXCIpO3Rocm93IHt0eXBlOlwid2ViZ2wgc2l6ZSBlcnJvclwiLHdpZHRoOmFrLG1heFdpZHRoOmFwfX19fWlmKGFyIT09YSYmKGFyLmhvcml6b25QaXRjaCE9PWF8fGFyLmhvcml6b25Sb2xsIT09YSkpe0Q9W2FyLmhvcml6b25QaXRjaD09YT8wOmFyLmhvcml6b25QaXRjaCxhci5ob3Jpem9uUm9sbD09YT8wOmFyLmhvcml6b25Sb2xsXX12YXIgYWQ9cy5URVhUVVJFXzJEO3Mudmlld3BvcnQoMCwwLHMuZHJhd2luZ0J1ZmZlcldpZHRoLHMuZHJhd2luZ0J1ZmZlckhlaWdodCk7dD1zLmNyZWF0ZVNoYWRlcihzLlZFUlRFWF9TSEFERVIpO3ZhciBhZT1pO2lmKE89PVwibXVsdGlyZXNcIil7YWU9ZX1zLnNoYWRlclNvdXJjZSh0LGFlKTtzLmNvbXBpbGVTaGFkZXIodCk7Qz1zLmNyZWF0ZVNoYWRlcihzLkZSQUdNRU5UX1NIQURFUik7dmFyIGF0PWg7aWYoTz09XCJjdWJlbWFwXCIpe2FkPXMuVEVYVFVSRV9DVUJFX01BUDthdD1qfWVsc2V7aWYoTz09XCJtdWx0aXJlc1wiKXthdD1ifX1zLnNoYWRlclNvdXJjZShDLGF0KTtzLmNvbXBpbGVTaGFkZXIoQyk7az1zLmNyZWF0ZVByb2dyYW0oKTtzLmF0dGFjaFNoYWRlcihrLHQpO3MuYXR0YWNoU2hhZGVyKGssQyk7cy5saW5rUHJvZ3JhbShrKTtpZighcy5nZXRTaGFkZXJQYXJhbWV0ZXIodCxzLkNPTVBJTEVfU1RBVFVTKSl7Y29uc29sZS5sb2cocy5nZXRTaGFkZXJJbmZvTG9nKHQpKX1pZighcy5nZXRTaGFkZXJQYXJhbWV0ZXIoQyxzLkNPTVBJTEVfU1RBVFVTKSl7Y29uc29sZS5sb2cocy5nZXRTaGFkZXJJbmZvTG9nKEMpKX1pZighcy5nZXRQcm9ncmFtUGFyYW1ldGVyKGsscy5MSU5LX1NUQVRVUykpe2NvbnNvbGUubG9nKHMuZ2V0UHJvZ3JhbUluZm9Mb2coaykpfXMudXNlUHJvZ3JhbShrKTtrLmRyYXdJblByb2dyZXNzPWZhbHNlO2sudGV4Q29vcmRMb2NhdGlvbj1zLmdldEF0dHJpYkxvY2F0aW9uKGssXCJhX3RleENvb3JkXCIpO3MuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoay50ZXhDb29yZExvY2F0aW9uKTtpZihPIT1cIm11bHRpcmVzXCIpe2lmKCFLKXtLPXMuY3JlYXRlQnVmZmVyKCl9cy5iaW5kQnVmZmVyKHMuQVJSQVlfQlVGRkVSLEspO3MuYnVmZmVyRGF0YShzLkFSUkFZX0JVRkZFUixuZXcgRmxvYXQzMkFycmF5KFstMSwxLDEsMSwxLC0xLC0xLDEsMSwtMSwtMSwtMV0pLHMuU1RBVElDX0RSQVcpO3MudmVydGV4QXR0cmliUG9pbnRlcihrLnRleENvb3JkTG9jYXRpb24sMixzLkZMT0FULGZhbHNlLDAsMCk7ay5hc3BlY3RSYXRpbz1zLmdldFVuaWZvcm1Mb2NhdGlvbihrLFwidV9hc3BlY3RSYXRpb1wiKTtzLnVuaWZvcm0xZihrLmFzcGVjdFJhdGlvLHMuZHJhd2luZ0J1ZmZlcldpZHRoL3MuZHJhd2luZ0J1ZmZlckhlaWdodCk7ay5wc2k9cy5nZXRVbmlmb3JtTG9jYXRpb24oayxcInVfcHNpXCIpO2sudGhldGE9cy5nZXRVbmlmb3JtTG9jYXRpb24oayxcInVfdGhldGFcIik7ay5mPXMuZ2V0VW5pZm9ybUxvY2F0aW9uKGssXCJ1X2ZcIik7ay5oPXMuZ2V0VW5pZm9ybUxvY2F0aW9uKGssXCJ1X2hcIik7ay52PXMuZ2V0VW5pZm9ybUxvY2F0aW9uKGssXCJ1X3ZcIik7ay52bz1zLmdldFVuaWZvcm1Mb2NhdGlvbihrLFwidV92b1wiKTtrLnJvdD1zLmdldFVuaWZvcm1Mb2NhdGlvbihrLFwidV9yb3RcIik7cy51bmlmb3JtMWYoay5oLGFnLyhNYXRoLlBJKjIpKTtzLnVuaWZvcm0xZihrLnYsYWgvTWF0aC5QSSk7cy51bmlmb3JtMWYoay52byxZL01hdGguUEkqMik7aWYoTz09XCJlcXVpcmVjdGFuZ3VsYXJcIil7ay5iYWNrZ3JvdW5kQ29sb3I9cy5nZXRVbmlmb3JtTG9jYXRpb24oayxcInVfYmFja2dyb3VuZENvbG9yXCIpO3ZhciBhbT1hci5iYWNrZ3JvdW5kQ29sb3I/YXIuYmFja2dyb3VuZENvbG9yOlswLDAsMF07cy51bmlmb3JtNGZ2KGsuYmFja2dyb3VuZENvbG9yLGFtLmNvbmNhdChbMV0pKX1rLnRleHR1cmU9cy5jcmVhdGVUZXh0dXJlKCk7cy5iaW5kVGV4dHVyZShhZCxrLnRleHR1cmUpO2lmKE89PVwiY3ViZW1hcFwiKXtzLnRleEltYWdlMkQocy5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1gsMCxzLlJHQixzLlJHQixzLlVOU0lHTkVEX0JZVEUscFsxXSk7cy50ZXhJbWFnZTJEKHMuVEVYVFVSRV9DVUJFX01BUF9ORUdBVElWRV9YLDAscy5SR0Iscy5SR0Iscy5VTlNJR05FRF9CWVRFLHBbM10pO3MudGV4SW1hZ2UyRChzLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWSwwLHMuUkdCLHMuUkdCLHMuVU5TSUdORURfQllURSxwWzRdKTtzLnRleEltYWdlMkQocy5URVhUVVJFX0NVQkVfTUFQX05FR0FUSVZFX1ksMCxzLlJHQixzLlJHQixzLlVOU0lHTkVEX0JZVEUscFs1XSk7cy50ZXhJbWFnZTJEKHMuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9aLDAscy5SR0Iscy5SR0Iscy5VTlNJR05FRF9CWVRFLHBbMF0pO3MudGV4SW1hZ2UyRChzLlRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWiwwLHMuUkdCLHMuUkdCLHMuVU5TSUdORURfQllURSxwWzJdKX1lbHNle3MudGV4SW1hZ2UyRChhZCwwLHMuUkdCLHMuUkdCLHMuVU5TSUdORURfQllURSxwKX1zLnRleFBhcmFtZXRlcmkoYWQscy5URVhUVVJFX1dSQVBfUyxzLkNMQU1QX1RPX0VER0UpO3MudGV4UGFyYW1ldGVyaShhZCxzLlRFWFRVUkVfV1JBUF9ULHMuQ0xBTVBfVE9fRURHRSk7cy50ZXhQYXJhbWV0ZXJpKGFkLHMuVEVYVFVSRV9NSU5fRklMVEVSLHMuTElORUFSKTtzLnRleFBhcmFtZXRlcmkoYWQscy5URVhUVVJFX01BR19GSUxURVIscy5MSU5FQVIpfWVsc2V7ay52ZXJ0UG9zTG9jYXRpb249cy5nZXRBdHRyaWJMb2NhdGlvbihrLFwiYV92ZXJ0Q29vcmRcIik7cy5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShrLnZlcnRQb3NMb2NhdGlvbik7aWYoIW0pe209cy5jcmVhdGVCdWZmZXIoKX1pZighUCl7UD1zLmNyZWF0ZUJ1ZmZlcigpfWlmKCFTKXtTPXMuY3JlYXRlQnVmZmVyKCl9cy5iaW5kQnVmZmVyKHMuQVJSQVlfQlVGRkVSLFApO3MuYnVmZmVyRGF0YShzLkFSUkFZX0JVRkZFUixuZXcgRmxvYXQzMkFycmF5KFswLDAsMSwwLDEsMSwwLDFdKSxzLlNUQVRJQ19EUkFXKTtzLmJpbmRCdWZmZXIocy5FTEVNRU5UX0FSUkFZX0JVRkZFUixTKTtzLmJ1ZmZlckRhdGEocy5FTEVNRU5UX0FSUkFZX0JVRkZFUixuZXcgVWludDE2QXJyYXkoWzAsMSwyLDAsMiwzXSkscy5TVEFUSUNfRFJBVyk7ay5wZXJzcFVuaWZvcm09cy5nZXRVbmlmb3JtTG9jYXRpb24oayxcInVfcGVyc3BNYXRyaXhcIik7ay5jdWJlVW5pZm9ybT1zLmdldFVuaWZvcm1Mb2NhdGlvbihrLFwidV9jdWJlTWF0cml4XCIpO2subGV2ZWw9LTE7ay5jdXJyZW50Tm9kZXM9W107ay5ub2RlQ2FjaGU9W107ay5ub2RlQ2FjaGVUaW1lc3RhbXA9MH12YXIgYWE9cy5nZXRFcnJvcigpO2lmKGFhIT09MCl7Y29uc29sZS5sb2coXCJFcnJvcjogU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2l0aCBXZWJHTCFcIixhYSk7dGhyb3cge3R5cGU6XCJ3ZWJnbCBlcnJvclwifX1hYigpfTt0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXtpZihIIT09YSl7aWYociE9PWEmJkguY29udGFpbnMocikpe0gucmVtb3ZlQ2hpbGQocil9aWYoQiE9PWEmJkguY29udGFpbnMoQikpe0gucmVtb3ZlQ2hpbGQoQil9fWlmKHMpe3ZhciBXPXMuZ2V0RXh0ZW5zaW9uKFwiV0VCR0xfbG9zZV9jb250ZXh0XCIpO2lmKFcpe1cubG9zZUNvbnRleHQoKX19fTt0aGlzLnJlc2l6ZT1mdW5jdGlvbigpe3ZhciBXPWYuZGV2aWNlUGl4ZWxSYXRpb3x8MTtyLndpZHRoPXIuY2xpZW50V2lkdGgqVztyLmhlaWdodD1yLmNsaWVudEhlaWdodCpXO2lmKHMpe2lmKHMuZ2V0RXJyb3IoKT09MTI4Nil7VigpfXMudmlld3BvcnQoMCwwLHMuZHJhd2luZ0J1ZmZlcldpZHRoLHMuZHJhd2luZ0J1ZmZlckhlaWdodCk7aWYoTyE9XCJtdWx0aXJlc1wiKXtzLnVuaWZvcm0xZihrLmFzcGVjdFJhdGlvLHIuY2xpZW50V2lkdGgvci5jbGllbnRIZWlnaHQpfX19O3RoaXMucmVzaXplKCk7dGhpcy5zZXRQb3NlPWZ1bmN0aW9uKFcsWCl7RD1bVyxYXX07dGhpcy5yZW5kZXI9ZnVuY3Rpb24oYWssYW4sYWIsYXope3ZhciBhQSxhdixhdCxheT0wO2lmKGF6PT09YSl7YXo9e319aWYoYXoucm9sbCl7YXk9YXoucm9sbH1pZihEIT09YSl7dmFyIGFjPURbMF0sYWg9RFsxXTt2YXIgWT1hayxaPWFuLGFvPU1hdGguY29zKGFoKSpNYXRoLnNpbihhaykqTWF0aC5zaW4oYWMpK01hdGguY29zKGFrKSooTWF0aC5jb3MoYWMpKk1hdGguY29zKGFuKStNYXRoLnNpbihhaCkqTWF0aC5zaW4oYWMpKk1hdGguc2luKGFuKSksYW09LU1hdGguc2luKGFrKSpNYXRoLnNpbihhaCkrTWF0aC5jb3MoYWspKk1hdGguY29zKGFoKSpNYXRoLnNpbihhbiksYWo9TWF0aC5jb3MoYWgpKk1hdGguY29zKGFjKSpNYXRoLnNpbihhaykrTWF0aC5jb3MoYWspKigtTWF0aC5jb3MoYW4pKk1hdGguc2luKGFjKStNYXRoLmNvcyhhYykqTWF0aC5zaW4oYWgpKk1hdGguc2luKGFuKSk7YWs9TWF0aC5hc2luKE1hdGgubWF4KE1hdGgubWluKGFqLDEpLC0xKSk7YW49TWF0aC5hdGFuMihhbSxhbyk7dmFyIGFyPVtNYXRoLmNvcyhZKSooTWF0aC5zaW4oYWgpKk1hdGguc2luKGFjKSpNYXRoLmNvcyhaKS1NYXRoLmNvcyhhYykqTWF0aC5zaW4oWikpLE1hdGguY29zKFkpKk1hdGguY29zKGFoKSpNYXRoLmNvcyhaKSxNYXRoLmNvcyhZKSooTWF0aC5jb3MoYWMpKk1hdGguc2luKGFoKSpNYXRoLmNvcyhaKStNYXRoLnNpbihaKSpNYXRoLnNpbihhYykpXSxhcD1bLU1hdGguY29zKGFrKSpNYXRoLnNpbihhbiksTWF0aC5jb3MoYWspKk1hdGguY29zKGFuKV07dmFyIGFkPU1hdGguYWNvcyhNYXRoLm1heChNYXRoLm1pbigoYXJbMF0qYXBbMF0rYXJbMV0qYXBbMV0pLyhNYXRoLnNxcnQoYXJbMF0qYXJbMF0rYXJbMV0qYXJbMV0rYXJbMl0qYXJbMl0pKk1hdGguc3FydChhcFswXSphcFswXSthcFsxXSphcFsxXSkpLDEpLC0xKSk7aWYoYXJbMl08MCl7YWQ9MipNYXRoLlBJLWFkfWF5Kz1hZH1pZighcyYmKE89PVwibXVsdGlyZXNcInx8Tz09XCJjdWJlbWFwXCIpKXthdD1MLzI7dmFyIGFsPXtmOlwidHJhbnNsYXRlM2QoLVwiKyhhdCsyKStcInB4LCAtXCIrKGF0KzIpK1wicHgsIC1cIithdCtcInB4KVwiLGI6XCJ0cmFuc2xhdGUzZChcIisoYXQrMikrXCJweCwgLVwiKyhhdCsyKStcInB4LCBcIithdCtcInB4KSByb3RhdGVYKDE4MGRlZykgcm90YXRlWigxODBkZWcpXCIsdTpcInRyYW5zbGF0ZTNkKC1cIisoYXQrMikrXCJweCwgLVwiK2F0K1wicHgsIFwiKyhhdCsyKStcInB4KSByb3RhdGVYKDI3MGRlZylcIixkOlwidHJhbnNsYXRlM2QoLVwiKyhhdCsyKStcInB4LCBcIithdCtcInB4LCAtXCIrKGF0KzIpK1wicHgpIHJvdGF0ZVgoOTBkZWcpXCIsbDpcInRyYW5zbGF0ZTNkKC1cIithdCtcInB4LCAtXCIrKGF0KzIpK1wicHgsIFwiKyhhdCsyKStcInB4KSByb3RhdGVYKDE4MGRlZykgcm90YXRlWSg5MGRlZykgcm90YXRlWigxODBkZWcpXCIscjpcInRyYW5zbGF0ZTNkKFwiK2F0K1wicHgsIC1cIisoYXQrMikrXCJweCwgLVwiKyhhdCsyKStcInB4KSByb3RhdGVZKDI3MGRlZylcIn07YUE9MS9NYXRoLnRhbihhYi8yKTt2YXIgWD1hQSpzLmRyYXdpbmdCdWZmZXJXaWR0aC8yK1wicHhcIjt2YXIgYXE9XCJwZXJzcGVjdGl2ZShcIitYK1wiKSB0cmFuc2xhdGVaKFwiK1grXCIpIHJvdGF0ZVgoXCIrYWsrXCJyYWQpIHJvdGF0ZVkoXCIrYW4rXCJyYWQpIFwiO3ZhciBhYT1PYmplY3Qua2V5cyhhbCk7Zm9yKGF2PTA7YXY8NjthdisrKXt2YXIgYWk9Qi5xdWVyeVNlbGVjdG9yKFwiLnBubG0tXCIrYWFbYXZdK1wiZmFjZVwiKS5zdHlsZTthaS53ZWJraXRUcmFuc2Zvcm09YXErYWxbYWFbYXZdXTthaS50cmFuc2Zvcm09YXErYWxbYWFbYXZdXX1yZXR1cm59aWYoTyE9XCJtdWx0aXJlc1wiKXt2YXIgYWc9MipNYXRoLmF0YW4oTWF0aC50YW4oYWIqMC41KS8ocy5kcmF3aW5nQnVmZmVyV2lkdGgvcy5kcmF3aW5nQnVmZmVySGVpZ2h0KSk7YUE9MS9NYXRoLnRhbihhZyowLjUpO3MudW5pZm9ybTFmKGsucHNpLGFuKTtzLnVuaWZvcm0xZihrLnRoZXRhLGFrKTtzLnVuaWZvcm0xZihrLnJvdCxheSk7cy51bmlmb3JtMWYoay5mLGFBKTtpZih6PT09dHJ1ZSl7aWYoTz09XCJlcXVpcmVjdGFuZ3VsYXJcIil7cy5iaW5kVGV4dHVyZShzLlRFWFRVUkVfMkQsay50ZXh0dXJlKTtzLnRleEltYWdlMkQocy5URVhUVVJFXzJELDAscy5SR0Iscy5SR0Iscy5VTlNJR05FRF9CWVRFLHApfX1zLmRyYXdBcnJheXMocy5UUklBTkdMRVMsMCw2KX1lbHNle3ZhciBXPW8oYWIscy5kcmF3aW5nQnVmZmVyV2lkdGgvcy5kcmF3aW5nQnVmZmVySGVpZ2h0LDAuMSwxMDApO3EoYWIpO3ZhciBhdT1sKCk7YXU9SihhdSwtYXksXCJ6XCIpO2F1PUooYXUsLWFrLFwieFwiKTthdT1KKGF1LGFuLFwieVwiKTthdT1HKGF1KTtzLnVuaWZvcm1NYXRyaXg0ZnYoay5wZXJzcFVuaWZvcm0sZmFsc2UsbmV3IEZsb2F0MzJBcnJheSh1KFcpKSk7cy51bmlmb3JtTWF0cml4NGZ2KGsuY3ViZVVuaWZvcm0sZmFsc2UsbmV3IEZsb2F0MzJBcnJheSh1KGF1KSkpO3ZhciBhZj1RKFcsYXUpO2subm9kZUNhY2hlLnNvcnQoTik7aWYoay5ub2RlQ2FjaGUubGVuZ3RoPjIwMCYmay5ub2RlQ2FjaGUubGVuZ3RoPmsuY3VycmVudE5vZGVzLmxlbmd0aCs1MCl7dmFyIGF3PWsubm9kZUNhY2hlLnNwbGljZSgyMDAsay5ub2RlQ2FjaGUubGVuZ3RoLTIwMCk7Zm9yKHZhciBhdj0wO2F2PGF3Lmxlbmd0aDthdisrKXtzLmRlbGV0ZVRleHR1cmUoYXdbYXZdLnRleHR1cmUpfX1rLmN1cnJlbnROb2Rlcz1bXTt2YXIgYXg9W1wiZlwiLFwiYlwiLFwidVwiLFwiZFwiLFwibFwiLFwiclwiXTtmb3IoYXQ9MDthdDw2O2F0Kyspe3ZhciBhZT1uZXcgbihUW2F0XSxheFthdF0sMSwwLDAscC5mdWxscGF0aCk7QShhZixhZSxhayxhbixhYil9ay5jdXJyZW50Tm9kZXMuc29ydChVKTtmb3IoYXY9MDthdjxrLmN1cnJlbnROb2Rlcy5sZW5ndGg7YXYrKyl7aWYoIWsuY3VycmVudE5vZGVzW2F2XS50ZXh0dXJlKXtzZXRUaW1lb3V0KHcsMCxrLmN1cnJlbnROb2Rlc1thdl0pO2JyZWFrfX1GKCl9aWYoYXoucmV0dXJuSW1hZ2UhPT1hKXtyZXR1cm4gci50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIil9fTt0aGlzLmlzTG9hZGluZz1mdW5jdGlvbigpe2lmKHMmJk89PVwibXVsdGlyZXNcIil7Zm9yKHZhciBXPTA7VzxrLmN1cnJlbnROb2Rlcy5sZW5ndGg7VysrKXtpZighay5jdXJyZW50Tm9kZXNbV10udGV4dHVyZUxvYWRlZCl7cmV0dXJuIHRydWV9fX1yZXR1cm4gZmFsc2V9O3RoaXMuZ2V0Q2FudmFzPWZ1bmN0aW9uKCl7cmV0dXJuIHJ9O2Z1bmN0aW9uIE4oWCxXKXtpZihYLmxldmVsPT0xJiZXLmxldmVsIT0xKXtyZXR1cm4gLTF9aWYoVy5sZXZlbD09MSYmWC5sZXZlbCE9MSl7cmV0dXJuIDF9cmV0dXJuIFcudGltZXN0YW1wLVgudGltZXN0YW1wfWZ1bmN0aW9uIFUoWCxXKXtpZihYLmxldmVsIT1XLmxldmVsKXtyZXR1cm4gWC5sZXZlbC1XLmxldmVsfXJldHVybiBYLmRpZmYtVy5kaWZmfWZ1bmN0aW9uIEYoKXtpZighay5kcmF3SW5Qcm9ncmVzcyl7ay5kcmF3SW5Qcm9ncmVzcz10cnVlO2Zvcih2YXIgVz0wO1c8ay5jdXJyZW50Tm9kZXMubGVuZ3RoO1crKyl7aWYoay5jdXJyZW50Tm9kZXNbV10udGV4dHVyZUxvYWRlZCl7cy5iaW5kQnVmZmVyKHMuQVJSQVlfQlVGRkVSLG0pO3MuYnVmZmVyRGF0YShzLkFSUkFZX0JVRkZFUixuZXcgRmxvYXQzMkFycmF5KGsuY3VycmVudE5vZGVzW1ddLnZlcnRpY2VzKSxzLlNUQVRJQ19EUkFXKTtzLnZlcnRleEF0dHJpYlBvaW50ZXIoay52ZXJ0UG9zTG9jYXRpb24sMyxzLkZMT0FULGZhbHNlLDAsMCk7cy5iaW5kQnVmZmVyKHMuQVJSQVlfQlVGRkVSLFApO3MudmVydGV4QXR0cmliUG9pbnRlcihrLnRleENvb3JkTG9jYXRpb24sMixzLkZMT0FULGZhbHNlLDAsMCk7cy5iaW5kVGV4dHVyZShzLlRFWFRVUkVfMkQsay5jdXJyZW50Tm9kZXNbV10udGV4dHVyZSk7cy5kcmF3RWxlbWVudHMocy5UUklBTkdMRVMsNixzLlVOU0lHTkVEX1NIT1JULDApfX1rLmRyYXdJblByb2dyZXNzPWZhbHNlfX1mdW5jdGlvbiBuKFgsWSxhYixXLGFhLFope3RoaXMudmVydGljZXM9WDt0aGlzLnNpZGU9WTt0aGlzLmxldmVsPWFiO3RoaXMueD1XO3RoaXMueT1hYTt0aGlzLnBhdGg9Wi5yZXBsYWNlKFwiJXNcIixZKS5yZXBsYWNlKFwiJWxcIixhYikucmVwbGFjZShcIiV4XCIsVykucmVwbGFjZShcIiV5XCIsYWEpfWZ1bmN0aW9uIEEoYWMsYXUsYWYsYWgsWSl7aWYodihhYyxhdS52ZXJ0aWNlcykpe3ZhciBhaz1hdS52ZXJ0aWNlczt2YXIgYWk9YWtbMF0rYWtbM10rYWtbNl0rYWtbOV07dmFyIGFnPWFrWzFdK2FrWzRdK2FrWzddK2FrWzEwXTt2YXIgYWU9YWtbMl0rYWtbNV0rYWtbOF0rYWtbMTFdO3ZhciBhbD1NYXRoLnNxcnQoYWkqYWkrYWcqYWcrYWUqYWUpO3ZhciBhZD1NYXRoLmFzaW4oYWUvYWwpO3ZhciBXPU1hdGguYXRhbjIoYWcsYWkpO3ZhciBaPVctYWg7Wis9KFo+TWF0aC5QSSk/LTIqTWF0aC5QSTooWjwtTWF0aC5QSSk/MipNYXRoLlBJOjA7Wj1NYXRoLmFicyhaKTthdS5kaWZmPU1hdGguYWNvcyhNYXRoLnNpbihhZikqTWF0aC5zaW4oYWQpK01hdGguY29zKGFmKSpNYXRoLmNvcyhhZCkqTWF0aC5jb3MoWikpO3ZhciBhbj1mYWxzZTtmb3IodmFyIGF3PTA7YXc8ay5ub2RlQ2FjaGUubGVuZ3RoO2F3Kyspe2lmKGsubm9kZUNhY2hlW2F3XS5wYXRoPT1hdS5wYXRoKXthbj10cnVlO2subm9kZUNhY2hlW2F3XS50aW1lc3RhbXA9ay5ub2RlQ2FjaGVUaW1lc3RhbXArKztrLm5vZGVDYWNoZVthd10uZGlmZj1hdS5kaWZmO2suY3VycmVudE5vZGVzLnB1c2goay5ub2RlQ2FjaGVbYXddKTticmVha319aWYoIWFuKXthdS50aW1lc3RhbXA9ay5ub2RlQ2FjaGVUaW1lc3RhbXArKztrLmN1cnJlbnROb2Rlcy5wdXNoKGF1KTtrLm5vZGVDYWNoZS5wdXNoKGF1KX1pZihhdS5sZXZlbDxrLmxldmVsKXt2YXIgYUI9cC5jdWJlUmVzb2x1dGlvbipNYXRoLnBvdygyLGF1LmxldmVsLXAubWF4TGV2ZWwpO3ZhciBhQT1NYXRoLmNlaWwoYUIqcC5pbnZUaWxlUmVzb2x1dGlvbiktMTt2YXIgYXE9YUIlcC50aWxlUmVzb2x1dGlvbioyO3ZhciBYPShhQioyKSVwLnRpbGVSZXNvbHV0aW9uO2lmKFg9PT0wKXtYPXAudGlsZVJlc29sdXRpb259aWYoYXE9PT0wKXthcT1wLnRpbGVSZXNvbHV0aW9uKjJ9dmFyIGF6PTAuNTtpZihhdS54PT1hQXx8YXUueT09YUEpe2F6PTEtcC50aWxlUmVzb2x1dGlvbi8ocC50aWxlUmVzb2x1dGlvbitYKX12YXIgYXk9MS1hejt2YXIgYWE9W107dmFyIGFqLGFiO3ZhciBhdD1heixhcD1heixhbT1heixhdj1heSxhcj1heSxhbz1heTtpZihYPHAudGlsZVJlc29sdXRpb24pe2lmKGF1Lng9PWFBJiZhdS55IT1hQSl7YXA9MC41O2FyPTAuNTtpZihhdS5zaWRlPT1cImRcInx8YXUuc2lkZT09XCJ1XCIpe2FtPTAuNTthbz0wLjV9fWVsc2V7aWYoYXUueCE9YUEmJmF1Lnk9PWFBKXthdD0wLjU7YXY9MC41O2lmKGF1LnNpZGU9PVwibFwifHxhdS5zaWRlPT1cInJcIil7YW09MC41O2FvPTAuNX19fX1pZihhcTw9cC50aWxlUmVzb2x1dGlvbil7aWYoYXUueD09YUEpe2F0PTA7YXY9MTtpZihhdS5zaWRlPT1cImxcInx8YXUuc2lkZT09XCJyXCIpe2FtPTA7YW89MX19aWYoYXUueT09YUEpe2FwPTA7YXI9MTtpZihhdS5zaWRlPT1cImRcInx8YXUuc2lkZT09XCJ1XCIpe2FtPTA7YW89MX19fWFqPVtha1swXSxha1sxXSxha1syXSxha1swXSphdCtha1szXSphdixha1sxXSpheitha1s0XSpheSxha1syXSphbStha1s1XSphbyxha1swXSphdCtha1s2XSphdixha1sxXSphcCtha1s3XSphcixha1syXSphbStha1s4XSphbyxha1swXSpheitha1s5XSpheSxha1sxXSphcCtha1sxMF0qYXIsYWtbMl0qYW0rYWtbMTFdKmFvXTthYj1uZXcgbihhaixhdS5zaWRlLGF1LmxldmVsKzEsYXUueCoyLGF1LnkqMixwLmZ1bGxwYXRoKTthYS5wdXNoKGFiKTtpZighKGF1Lng9PWFBJiZhcTw9cC50aWxlUmVzb2x1dGlvbikpe2FqPVtha1swXSphdCtha1szXSphdixha1sxXSpheitha1s0XSpheSxha1syXSphbStha1s1XSphbyxha1szXSxha1s0XSxha1s1XSxha1szXSpheitha1s2XSpheSxha1s0XSphcCtha1s3XSphcixha1s1XSphbStha1s4XSphbyxha1swXSphdCtha1s2XSphdixha1sxXSphcCtha1s3XSphcixha1syXSphbStha1s4XSphb107YWI9bmV3IG4oYWosYXUuc2lkZSxhdS5sZXZlbCsxLGF1LngqMisxLGF1LnkqMixwLmZ1bGxwYXRoKTthYS5wdXNoKGFiKX1pZighKGF1Lng9PWFBJiZhcTw9cC50aWxlUmVzb2x1dGlvbikmJiEoYXUueT09YUEmJmFxPD1wLnRpbGVSZXNvbHV0aW9uKSl7YWo9W2FrWzBdKmF0K2FrWzZdKmF2LGFrWzFdKmFwK2FrWzddKmFyLGFrWzJdKmFtK2FrWzhdKmFvLGFrWzNdKmF6K2FrWzZdKmF5LGFrWzRdKmFwK2FrWzddKmFyLGFrWzVdKmFtK2FrWzhdKmFvLGFrWzZdLGFrWzddLGFrWzhdLGFrWzldKmF0K2FrWzZdKmF2LGFrWzEwXSpheitha1s3XSpheSxha1sxMV0qYW0rYWtbOF0qYW9dO2FiPW5ldyBuKGFqLGF1LnNpZGUsYXUubGV2ZWwrMSxhdS54KjIrMSxhdS55KjIrMSxwLmZ1bGxwYXRoKTthYS5wdXNoKGFiKX1pZighKGF1Lnk9PWFBJiZhcTw9cC50aWxlUmVzb2x1dGlvbikpe2FqPVtha1swXSpheitha1s5XSpheSxha1sxXSphcCtha1sxMF0qYXIsYWtbMl0qYW0rYWtbMTFdKmFvLGFrWzBdKmF0K2FrWzZdKmF2LGFrWzFdKmFwK2FrWzddKmFyLGFrWzJdKmFtK2FrWzhdKmFvLGFrWzldKmF0K2FrWzZdKmF2LGFrWzEwXSpheitha1s3XSpheSxha1sxMV0qYW0rYWtbOF0qYW8sYWtbOV0sYWtbMTBdLGFrWzExXV07YWI9bmV3IG4oYWosYXUuc2lkZSxhdS5sZXZlbCsxLGF1LngqMixhdS55KjIrMSxwLmZ1bGxwYXRoKTthYS5wdXNoKGFiKX1mb3IodmFyIGF4PTA7YXg8YWEubGVuZ3RoO2F4Kyspe0EoYWMsYWFbYXhdLGFmLGFoLFkpfX19fWZ1bmN0aW9uIHkoKXtyZXR1cm5bLTEsMSwtMSwxLDEsLTEsMSwtMSwtMSwtMSwtMSwtMSwxLDEsMSwtMSwxLDEsLTEsLTEsMSwxLC0xLDEsLTEsMSwxLDEsMSwxLDEsMSwtMSwtMSwxLC0xLC0xLC0xLC0xLDEsLTEsLTEsMSwtMSwxLC0xLC0xLDEsLTEsMSwxLC0xLDEsLTEsLTEsLTEsLTEsLTEsLTEsMSwxLDEsLTEsMSwxLDEsMSwtMSwxLDEsLTEsLTFdfWZ1bmN0aW9uIGwoKXtyZXR1cm5bMSwwLDAsMCwxLDAsMCwwLDFdfWZ1bmN0aW9uIEooVyxaLFkpe3ZhciBYPU1hdGguc2luKFopO3ZhciBhYT1NYXRoLmNvcyhaKTtpZihZPT1cInhcIil7cmV0dXJuW1dbMF0sYWEqV1sxXStYKldbMl0sYWEqV1syXS1YKldbMV0sV1szXSxhYSpXWzRdK1gqV1s1XSxhYSpXWzVdLVgqV1s0XSxXWzZdLGFhKldbN10rWCpXWzhdLGFhKldbOF0tWCpXWzddXX1pZihZPT1cInlcIil7cmV0dXJuW2FhKldbMF0tWCpXWzJdLFdbMV0sYWEqV1syXStYKldbMF0sYWEqV1szXS1YKldbNV0sV1s0XSxhYSpXWzVdK1gqV1szXSxhYSpXWzZdLVgqV1s4XSxXWzddLGFhKldbOF0rWCpXWzZdXX1pZihZPT1cInpcIil7cmV0dXJuW2FhKldbMF0rWCpXWzFdLGFhKldbMV0tWCpXWzBdLFdbMl0sYWEqV1szXStYKldbNF0sYWEqV1s0XS1YKldbM10sV1s1XSxhYSpXWzZdK1gqV1s3XSxhYSpXWzddLVgqV1s2XSxXWzhdXX19ZnVuY3Rpb24gRyhXKXtyZXR1cm5bV1swXSxXWzFdLFdbMl0sMCxXWzNdLFdbNF0sV1s1XSwwLFdbNl0sV1s3XSxXWzhdLDAsMCwwLDAsMV19ZnVuY3Rpb24gdShXKXtyZXR1cm5bV1swXSxXWzRdLFdbOF0sV1sxMl0sV1sxXSxXWzVdLFdbOV0sV1sxM10sV1syXSxXWzZdLFdbMTBdLFdbMTRdLFdbM10sV1s3XSxXWzExXSxXWzE1XV19ZnVuY3Rpb24gbyhhYixZLFcsYWEpe3ZhciBYPTIqTWF0aC5hdGFuKE1hdGgudGFuKGFiLzIpKnMuZHJhd2luZ0J1ZmZlckhlaWdodC9zLmRyYXdpbmdCdWZmZXJXaWR0aCk7dmFyIFo9MS9NYXRoLnRhbihYLzIpO3JldHVybltaL1ksMCwwLDAsMCxaLDAsMCwwLDAsKGFhK1cpLyhXLWFhKSwoMiphYSpXKS8oVy1hYSksMCwwLC0xLDBdfWZ1bmN0aW9uIEUoWCxXKXtzLmJpbmRUZXh0dXJlKHMuVEVYVFVSRV8yRCxXKTtzLnRleEltYWdlMkQocy5URVhUVVJFXzJELDAscy5SR0Iscy5SR0Iscy5VTlNJR05FRF9CWVRFLFgpO3MudGV4UGFyYW1ldGVyaShzLlRFWFRVUkVfMkQscy5URVhUVVJFX01BR19GSUxURVIscy5MSU5FQVIpO3MudGV4UGFyYW1ldGVyaShzLlRFWFRVUkVfMkQscy5URVhUVVJFX01JTl9GSUxURVIscy5MSU5FQVIpO3MudGV4UGFyYW1ldGVyaShzLlRFWFRVUkVfMkQscy5URVhUVVJFX1dSQVBfUyxzLkNMQU1QX1RPX0VER0UpO3MudGV4UGFyYW1ldGVyaShzLlRFWFRVUkVfMkQscy5URVhUVVJFX1dSQVBfVCxzLkNMQU1QX1RPX0VER0UpO3MuYmluZFRleHR1cmUocy5URVhUVVJFXzJELG51bGwpfXZhciBJPShmdW5jdGlvbigpe3ZhciBaPTQ7dmFyIFk9e307dmFyIGFiPVtdO3ZhciBYO2Z1bmN0aW9uIFcoKXt2YXIgYWU9dGhpczt0aGlzLnRleHR1cmU9dGhpcy5jYWxsYmFjaz1udWxsO3RoaXMuaW1hZ2U9bmV3IEltYWdlKCk7dGhpcy5pbWFnZS5jcm9zc09yaWdpbj1YP1g6XCJhbm9ueW1vdXNcIjt0aGlzLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsZnVuY3Rpb24oKXtFKGFlLmltYWdlLGFlLnRleHR1cmUpO2FlLmNhbGxiYWNrKGFlLnRleHR1cmUpO2FkKGFlKX0pfVcucHJvdG90eXBlLmxvYWRUZXh0dXJlPWZ1bmN0aW9uKGFmLGFlLGFnKXt0aGlzLnRleHR1cmU9YWU7dGhpcy5jYWxsYmFjaz1hZzt0aGlzLmltYWdlLnNyYz1hZn07ZnVuY3Rpb24gYWMoYWYsYWUsYWcpe3RoaXMuc3JjPWFmO3RoaXMudGV4dHVyZT1hZTt0aGlzLmNhbGxiYWNrPWFnfWZ1bmN0aW9uIGFkKGFlKXtpZihhYi5sZW5ndGgpe3ZhciBhZj1hYi5zaGlmdCgpO2FlLmxvYWRUZXh0dXJlKGFmLnNyYyxhZi50ZXh0dXJlLGFmLmNhbGxiYWNrKX1lbHNle1lbWisrXT1hZX19Zm9yKHZhciBhYT0wO2FhPFo7YWErKyl7WVthYV09bmV3IFcoKX1yZXR1cm4gZnVuY3Rpb24oYWcsYWgsYWYpe1g9YWY7dmFyIGFlPXMuY3JlYXRlVGV4dHVyZSgpO2lmKFope1lbLS1aXS5sb2FkVGV4dHVyZShhZyxhZSxhaCl9ZWxzZXthYi5wdXNoKG5ldyBhYyhhZyxhZSxhaCkpfXJldHVybiBhZX19KSgpO2Z1bmN0aW9uIHcoVyl7aWYoIVcudGV4dHVyZUxvYWQpe1cudGV4dHVyZUxvYWQ9dHJ1ZTtJKGVuY29kZVVSSShXLnBhdGgrXCIuXCIrcC5leHRlbnNpb24pLGZ1bmN0aW9uKFgpe1cudGV4dHVyZT1YO1cudGV4dHVyZUxvYWRlZD10cnVlfSxNLmNyb3NzT3JpZ2luKX19ZnVuY3Rpb24gcShYKXt2YXIgVz0xO3doaWxlKFc8cC5tYXhMZXZlbCYmcy5kcmF3aW5nQnVmZmVyV2lkdGg+cC50aWxlUmVzb2x1dGlvbipNYXRoLnBvdygyLFctMSkqTWF0aC50YW4oWC8yKSowLjcwNyl7VysrfWsubGV2ZWw9V31mdW5jdGlvbiBRKFgsVyl7cmV0dXJuW1hbMF0qV1swXSxYWzBdKldbMV0sWFswXSpXWzJdLDAsWFs1XSpXWzRdLFhbNV0qV1s1XSxYWzVdKldbNl0sMCxYWzEwXSpXWzhdLFhbMTBdKldbOV0sWFsxMF0qV1sxMF0sWFsxMV0sLVdbOF0sLVdbOV0sLVdbMTBdLDBdfWZ1bmN0aW9uIFIoVyxYKXtyZXR1cm5bV1swXSpYWzBdK1dbMV0qWFsxXStXWzJdKlhbMl0sV1s0XSpYWzBdK1dbNV0qWFsxXStXWzZdKlhbMl0sV1sxMV0rV1s4XSpYWzBdK1dbOV0qWFsxXStXWzEwXSpYWzJdLDEvKFdbMTJdKlhbMF0rV1sxM10qWFsxXStXWzE0XSpYWzJdKV19ZnVuY3Rpb24geChXLGFhKXt2YXIgWj1SKFcsYWEpO3ZhciBhYz1aWzBdKlpbM107dmFyIFk9WlsxXSpaWzNdO3ZhciBYPVpbMl0qWlszXTt2YXIgYWI9WzAsMCwwXTtpZihhYzwtMSl7YWJbMF09LTF9aWYoYWM+MSl7YWJbMF09MX1pZihZPC0xKXthYlsxXT0tMX1pZihZPjEpe2FiWzFdPTF9aWYoWDwtMXx8WD4xKXthYlsyXT0xfXJldHVybiBhYn1mdW5jdGlvbiB2KGFhLGFlKXt2YXIgWj14KGFhLGFlLnNsaWNlKDAsMykpO3ZhciBZPXgoYWEsYWUuc2xpY2UoMyw2KSk7dmFyIFg9eChhYSxhZS5zbGljZSg2LDkpKTt2YXIgVz14KGFhLGFlLnNsaWNlKDksMTIpKTt2YXIgYWQ9WlswXStZWzBdK1hbMF0rV1swXTtpZihhZD09LTR8fGFkPT00KXtyZXR1cm4gZmFsc2V9dmFyIGFjPVpbMV0rWVsxXStYWzFdK1dbMV07aWYoYWM9PS00fHxhYz09NCl7cmV0dXJuIGZhbHNlfXZhciBhYj1aWzJdK1lbMl0rWFsyXStXWzJdO3JldHVybiBhYiE9NH1mdW5jdGlvbiBWKCl7Y29uc29sZS5sb2coXCJSZWR1Y2luZyBjYW52YXMgc2l6ZSBkdWUgdG8gZXJyb3IgMTI4NiFcIik7ci53aWR0aD1NYXRoLnJvdW5kKHIud2lkdGgvMik7ci5oZWlnaHQ9TWF0aC5yb3VuZChyLmhlaWdodC8yKX19dmFyIGk9W1wiYXR0cmlidXRlIHZlYzIgYV90ZXhDb29yZDtcIixcInZhcnlpbmcgdmVjMiB2X3RleENvb3JkO1wiLFwidm9pZCBtYWluKCkge1wiLFwiZ2xfUG9zaXRpb24gPSB2ZWM0KGFfdGV4Q29vcmQsIDAuMCwgMS4wKTtcIixcInZfdGV4Q29vcmQgPSBhX3RleENvb3JkO1wiLFwifVwiXS5qb2luKFwiXCIpO3ZhciBlPVtcImF0dHJpYnV0ZSB2ZWMzIGFfdmVydENvb3JkO1wiLFwiYXR0cmlidXRlIHZlYzIgYV90ZXhDb29yZDtcIixcInVuaWZvcm0gbWF0NCB1X2N1YmVNYXRyaXg7XCIsXCJ1bmlmb3JtIG1hdDQgdV9wZXJzcE1hdHJpeDtcIixcInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZfdGV4Q29vcmQ7XCIsXCJ2b2lkIG1haW4odm9pZCkge1wiLFwiZ2xfUG9zaXRpb24gPSB1X3BlcnNwTWF0cml4ICogdV9jdWJlTWF0cml4ICogdmVjNChhX3ZlcnRDb29yZCwgMS4wKTtcIixcInZfdGV4Q29vcmQgPSBhX3RleENvb3JkO1wiLFwifVwiXS5qb2luKFwiXCIpO3ZhciBkPVtcInByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1wiLFwidW5pZm9ybSBmbG9hdCB1X2FzcGVjdFJhdGlvO1wiLFwidW5pZm9ybSBmbG9hdCB1X3BzaTtcIixcInVuaWZvcm0gZmxvYXQgdV90aGV0YTtcIixcInVuaWZvcm0gZmxvYXQgdV9mO1wiLFwidW5pZm9ybSBmbG9hdCB1X2g7XCIsXCJ1bmlmb3JtIGZsb2F0IHVfdjtcIixcInVuaWZvcm0gZmxvYXQgdV92bztcIixcInVuaWZvcm0gZmxvYXQgdV9yb3Q7XCIsXCJjb25zdCBmbG9hdCBQSSA9IDMuMTQxNTkyNjUzNTg5NzkzMjM4NDYyNjQ7XCIsXCJ1bmlmb3JtIHNhbXBsZXIyRCB1X2ltYWdlO1wiLFwidW5pZm9ybSBzYW1wbGVyQ3ViZSB1X2ltYWdlQ3ViZTtcIixcInZhcnlpbmcgdmVjMiB2X3RleENvb3JkO1wiLFwidW5pZm9ybSB2ZWM0IHVfYmFja2dyb3VuZENvbG9yO1wiLFwidm9pZCBtYWluKCkge1wiLFwiZmxvYXQgeCA9IHZfdGV4Q29vcmQueCAqIHVfYXNwZWN0UmF0aW87XCIsXCJmbG9hdCB5ID0gdl90ZXhDb29yZC55O1wiLFwiZmxvYXQgc2lucm90ID0gc2luKHVfcm90KTtcIixcImZsb2F0IGNvc3JvdCA9IGNvcyh1X3JvdCk7XCIsXCJmbG9hdCByb3RfeCA9IHggKiBjb3Nyb3QgLSB5ICogc2lucm90O1wiLFwiZmxvYXQgcm90X3kgPSB4ICogc2lucm90ICsgeSAqIGNvc3JvdDtcIixcImZsb2F0IHNpbnRoZXRhID0gc2luKHVfdGhldGEpO1wiLFwiZmxvYXQgY29zdGhldGEgPSBjb3ModV90aGV0YSk7XCIsXCJmbG9hdCBhID0gdV9mICogY29zdGhldGEgLSByb3RfeSAqIHNpbnRoZXRhO1wiLFwiZmxvYXQgcm9vdCA9IHNxcnQocm90X3ggKiByb3RfeCArIGEgKiBhKTtcIixcImZsb2F0IGxhbWJkYSA9IGF0YW4ocm90X3ggLyByb290LCBhIC8gcm9vdCkgKyB1X3BzaTtcIixcImZsb2F0IHBoaSA9IGF0YW4oKHJvdF95ICogY29zdGhldGEgKyB1X2YgKiBzaW50aGV0YSkgLyByb290KTtcIixdLmpvaW4oXCJcXG5cIik7dmFyIGo9ZCtbXCJmbG9hdCBjb3NwaGkgPSBjb3MocGhpKTtcIixcImdsX0ZyYWdDb2xvciA9IHRleHR1cmVDdWJlKHVfaW1hZ2VDdWJlLCB2ZWMzKGNvc3BoaSpzaW4obGFtYmRhKSwgc2luKHBoaSksIGNvc3BoaSpjb3MobGFtYmRhKSkpO1wiLFwifVwiXS5qb2luKFwiXFxuXCIpO3ZhciBoPWQrW1wibGFtYmRhID0gbW9kKGxhbWJkYSArIFBJLCBQSSAqIDIuMCkgLSBQSTtcIixcInZlYzIgY29vcmQgPSB2ZWMyKGxhbWJkYSAvIFBJLCBwaGkgLyAoUEkgLyAyLjApKTtcIixcImlmKGNvb3JkLnggPCAtdV9oIHx8IGNvb3JkLnggPiB1X2ggfHwgY29vcmQueSA8IC11X3YgKyB1X3ZvIHx8IGNvb3JkLnkgPiB1X3YgKyB1X3ZvKVwiLFwiZ2xfRnJhZ0NvbG9yID0gdV9iYWNrZ3JvdW5kQ29sb3I7XCIsXCJlbHNlXCIsXCJnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQodV9pbWFnZSwgdmVjMigoY29vcmQueCArIHVfaCkgLyAodV9oICogMi4wKSwgKC1jb29yZC55ICsgdV92ICsgdV92bykgLyAodV92ICogMi4wKSkpO1wiLFwifVwiXS5qb2luKFwiXFxuXCIpO3ZhciBiPVtcInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZfdGV4Q29vcmQ7XCIsXCJ1bmlmb3JtIHNhbXBsZXIyRCB1X3NhbXBsZXI7XCIsXCJ2b2lkIG1haW4odm9pZCkge1wiLFwiZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHVfc2FtcGxlciwgdl90ZXhDb29yZCk7XCIsXCJ9XCJdLmpvaW4oXCJcIik7cmV0dXJue3JlbmRlcmVyOmZ1bmN0aW9uKGwsbixrLG0pe3JldHVybiBuZXcgYyhsLG4sayxtKX19fSkod2luZG93LGRvY3VtZW50KTtcclxuXHJcbi8qIGltYWdlc0xvYWRlZCBQQUNLQUdFRCB2NC4xLjQgKi9cclxuIWZ1bmN0aW9uKGUsdCl7XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShcImV2LWVtaXR0ZXIvZXYtZW1pdHRlclwiLHQpOlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPXQoKTplLkV2RW1pdHRlcj10KCl9KFwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OnRoaXMsZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7fXZhciB0PWUucHJvdG90eXBlO3JldHVybiB0Lm9uPWZ1bmN0aW9uKGUsdCl7aWYoZSYmdCl7dmFyIGk9dGhpcy5fZXZlbnRzPXRoaXMuX2V2ZW50c3x8e30sbj1pW2VdPWlbZV18fFtdO3JldHVybiBuLmluZGV4T2YodCk9PS0xJiZuLnB1c2godCksdGhpc319LHQub25jZT1mdW5jdGlvbihlLHQpe2lmKGUmJnQpe3RoaXMub24oZSx0KTt2YXIgaT10aGlzLl9vbmNlRXZlbnRzPXRoaXMuX29uY2VFdmVudHN8fHt9LG49aVtlXT1pW2VdfHx7fTtyZXR1cm4gblt0XT0hMCx0aGlzfX0sdC5vZmY9ZnVuY3Rpb24oZSx0KXt2YXIgaT10aGlzLl9ldmVudHMmJnRoaXMuX2V2ZW50c1tlXTtpZihpJiZpLmxlbmd0aCl7dmFyIG49aS5pbmRleE9mKHQpO3JldHVybiBuIT0tMSYmaS5zcGxpY2UobiwxKSx0aGlzfX0sdC5lbWl0RXZlbnQ9ZnVuY3Rpb24oZSx0KXt2YXIgaT10aGlzLl9ldmVudHMmJnRoaXMuX2V2ZW50c1tlXTtpZihpJiZpLmxlbmd0aCl7aT1pLnNsaWNlKDApLHQ9dHx8W107Zm9yKHZhciBuPXRoaXMuX29uY2VFdmVudHMmJnRoaXMuX29uY2VFdmVudHNbZV0sbz0wO288aS5sZW5ndGg7bysrKXt2YXIgcj1pW29dLHM9biYmbltyXTtzJiYodGhpcy5vZmYoZSxyKSxkZWxldGUgbltyXSksci5hcHBseSh0aGlzLHQpfXJldHVybiB0aGlzfX0sdC5hbGxPZmY9ZnVuY3Rpb24oKXtkZWxldGUgdGhpcy5fZXZlbnRzLGRlbGV0ZSB0aGlzLl9vbmNlRXZlbnRzfSxlfSksZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImV2LWVtaXR0ZXIvZXYtZW1pdHRlclwiXSxmdW5jdGlvbihpKXtyZXR1cm4gdChlLGkpfSk6XCJvYmplY3RcIj09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9dChlLHJlcXVpcmUoXCJldi1lbWl0dGVyXCIpKTplLmltYWdlc0xvYWRlZD10KGUsZS5FdkVtaXR0ZXIpfShcInVuZGVmaW5lZFwiIT10eXBlb2Ygd2luZG93P3dpbmRvdzp0aGlzLGZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gaShlLHQpe2Zvcih2YXIgaSBpbiB0KWVbaV09dFtpXTtyZXR1cm4gZX1mdW5jdGlvbiBuKGUpe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGU7dmFyIHQ9XCJvYmplY3RcIj09dHlwZW9mIGUmJlwibnVtYmVyXCI9PXR5cGVvZiBlLmxlbmd0aDtyZXR1cm4gdD9kLmNhbGwoZSk6W2VdfWZ1bmN0aW9uIG8oZSx0LHIpe2lmKCEodGhpcyBpbnN0YW5jZW9mIG8pKXJldHVybiBuZXcgbyhlLHQscik7dmFyIHM9ZTtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgZSYmKHM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlKSkscz8odGhpcy5lbGVtZW50cz1uKHMpLHRoaXMub3B0aW9ucz1pKHt9LHRoaXMub3B0aW9ucyksXCJmdW5jdGlvblwiPT10eXBlb2YgdD9yPXQ6aSh0aGlzLm9wdGlvbnMsdCksciYmdGhpcy5vbihcImFsd2F5c1wiLHIpLHRoaXMuZ2V0SW1hZ2VzKCksaCYmKHRoaXMuanFEZWZlcnJlZD1uZXcgaC5EZWZlcnJlZCksdm9pZCBzZXRUaW1lb3V0KHRoaXMuY2hlY2suYmluZCh0aGlzKSkpOnZvaWQgYS5lcnJvcihcIkJhZCBlbGVtZW50IGZvciBpbWFnZXNMb2FkZWQgXCIrKHN8fGUpKX1mdW5jdGlvbiByKGUpe3RoaXMuaW1nPWV9ZnVuY3Rpb24gcyhlLHQpe3RoaXMudXJsPWUsdGhpcy5lbGVtZW50PXQsdGhpcy5pbWc9bmV3IEltYWdlfXZhciBoPWUualF1ZXJ5LGE9ZS5jb25zb2xlLGQ9QXJyYXkucHJvdG90eXBlLnNsaWNlO28ucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodC5wcm90b3R5cGUpLG8ucHJvdG90eXBlLm9wdGlvbnM9e30sby5wcm90b3R5cGUuZ2V0SW1hZ2VzPWZ1bmN0aW9uKCl7dGhpcy5pbWFnZXM9W10sdGhpcy5lbGVtZW50cy5mb3JFYWNoKHRoaXMuYWRkRWxlbWVudEltYWdlcyx0aGlzKX0sby5wcm90b3R5cGUuYWRkRWxlbWVudEltYWdlcz1mdW5jdGlvbihlKXtcIklNR1wiPT1lLm5vZGVOYW1lJiZ0aGlzLmFkZEltYWdlKGUpLHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kPT09ITAmJnRoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMoZSk7dmFyIHQ9ZS5ub2RlVHlwZTtpZih0JiZ1W3RdKXtmb3IodmFyIGk9ZS5xdWVyeVNlbGVjdG9yQWxsKFwiaW1nXCIpLG49MDtuPGkubGVuZ3RoO24rKyl7dmFyIG89aVtuXTt0aGlzLmFkZEltYWdlKG8pfWlmKFwic3RyaW5nXCI9PXR5cGVvZiB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCl7dmFyIHI9ZS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kKTtmb3Iobj0wO248ci5sZW5ndGg7bisrKXt2YXIgcz1yW25dO3RoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMocyl9fX19O3ZhciB1PXsxOiEwLDk6ITAsMTE6ITB9O3JldHVybiBvLnByb3RvdHlwZS5hZGRFbGVtZW50QmFja2dyb3VuZEltYWdlcz1mdW5jdGlvbihlKXt2YXIgdD1nZXRDb21wdXRlZFN0eWxlKGUpO2lmKHQpZm9yKHZhciBpPS91cmxcXCgoWydcIl0pPyguKj8pXFwxXFwpL2dpLG49aS5leGVjKHQuYmFja2dyb3VuZEltYWdlKTtudWxsIT09bjspe3ZhciBvPW4mJm5bMl07byYmdGhpcy5hZGRCYWNrZ3JvdW5kKG8sZSksbj1pLmV4ZWModC5iYWNrZ3JvdW5kSW1hZ2UpfX0sby5wcm90b3R5cGUuYWRkSW1hZ2U9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IHIoZSk7dGhpcy5pbWFnZXMucHVzaCh0KX0sby5wcm90b3R5cGUuYWRkQmFja2dyb3VuZD1mdW5jdGlvbihlLHQpe3ZhciBpPW5ldyBzKGUsdCk7dGhpcy5pbWFnZXMucHVzaChpKX0sby5wcm90b3R5cGUuY2hlY2s9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsaSxuKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dC5wcm9ncmVzcyhlLGksbil9KX12YXIgdD10aGlzO3JldHVybiB0aGlzLnByb2dyZXNzZWRDb3VudD0wLHRoaXMuaGFzQW55QnJva2VuPSExLHRoaXMuaW1hZ2VzLmxlbmd0aD92b2lkIHRoaXMuaW1hZ2VzLmZvckVhY2goZnVuY3Rpb24odCl7dC5vbmNlKFwicHJvZ3Jlc3NcIixlKSx0LmNoZWNrKCl9KTp2b2lkIHRoaXMuY29tcGxldGUoKX0sby5wcm90b3R5cGUucHJvZ3Jlc3M9ZnVuY3Rpb24oZSx0LGkpe3RoaXMucHJvZ3Jlc3NlZENvdW50KyssdGhpcy5oYXNBbnlCcm9rZW49dGhpcy5oYXNBbnlCcm9rZW58fCFlLmlzTG9hZGVkLHRoaXMuZW1pdEV2ZW50KFwicHJvZ3Jlc3NcIixbdGhpcyxlLHRdKSx0aGlzLmpxRGVmZXJyZWQmJnRoaXMuanFEZWZlcnJlZC5ub3RpZnkmJnRoaXMuanFEZWZlcnJlZC5ub3RpZnkodGhpcyxlKSx0aGlzLnByb2dyZXNzZWRDb3VudD09dGhpcy5pbWFnZXMubGVuZ3RoJiZ0aGlzLmNvbXBsZXRlKCksdGhpcy5vcHRpb25zLmRlYnVnJiZhJiZhLmxvZyhcInByb2dyZXNzOiBcIitpLGUsdCl9LG8ucHJvdG90eXBlLmNvbXBsZXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5oYXNBbnlCcm9rZW4/XCJmYWlsXCI6XCJkb25lXCI7aWYodGhpcy5pc0NvbXBsZXRlPSEwLHRoaXMuZW1pdEV2ZW50KGUsW3RoaXNdKSx0aGlzLmVtaXRFdmVudChcImFsd2F5c1wiLFt0aGlzXSksdGhpcy5qcURlZmVycmVkKXt2YXIgdD10aGlzLmhhc0FueUJyb2tlbj9cInJlamVjdFwiOlwicmVzb2x2ZVwiO3RoaXMuanFEZWZlcnJlZFt0XSh0aGlzKX19LHIucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodC5wcm90b3R5cGUpLHIucHJvdG90eXBlLmNoZWNrPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtyZXR1cm4gZT92b2lkIHRoaXMuY29uZmlybSgwIT09dGhpcy5pbWcubmF0dXJhbFdpZHRoLFwibmF0dXJhbFdpZHRoXCIpOih0aGlzLnByb3h5SW1hZ2U9bmV3IEltYWdlLHRoaXMucHJveHlJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLHRoaXMpLHRoaXMucHJveHlJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIix0aGlzKSx0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLHRoaXMpLHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLHRoaXMpLHZvaWQodGhpcy5wcm94eUltYWdlLnNyYz10aGlzLmltZy5zcmMpKX0sci5wcm90b3R5cGUuZ2V0SXNJbWFnZUNvbXBsZXRlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW1nLmNvbXBsZXRlJiZ0aGlzLmltZy5uYXR1cmFsV2lkdGh9LHIucHJvdG90eXBlLmNvbmZpcm09ZnVuY3Rpb24oZSx0KXt0aGlzLmlzTG9hZGVkPWUsdGhpcy5lbWl0RXZlbnQoXCJwcm9ncmVzc1wiLFt0aGlzLHRoaXMuaW1nLHRdKX0sci5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oZSl7dmFyIHQ9XCJvblwiK2UudHlwZTt0aGlzW3RdJiZ0aGlzW3RdKGUpfSxyLnByb3RvdHlwZS5vbmxvYWQ9ZnVuY3Rpb24oKXt0aGlzLmNvbmZpcm0oITAsXCJvbmxvYWRcIiksdGhpcy51bmJpbmRFdmVudHMoKX0sci5wcm90b3R5cGUub25lcnJvcj1mdW5jdGlvbigpe3RoaXMuY29uZmlybSghMSxcIm9uZXJyb3JcIiksdGhpcy51bmJpbmRFdmVudHMoKX0sci5wcm90b3R5cGUudW5iaW5kRXZlbnRzPWZ1bmN0aW9uKCl7dGhpcy5wcm94eUltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcyksdGhpcy5wcm94eUltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLHRoaXMpLHRoaXMuaW1nLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcyksdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsdGhpcyl9LHMucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoci5wcm90b3R5cGUpLHMucHJvdG90eXBlLmNoZWNrPWZ1bmN0aW9uKCl7dGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIix0aGlzKSx0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIix0aGlzKSx0aGlzLmltZy5zcmM9dGhpcy51cmw7dmFyIGU9dGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtlJiYodGhpcy5jb25maXJtKDAhPT10aGlzLmltZy5uYXR1cmFsV2lkdGgsXCJuYXR1cmFsV2lkdGhcIiksdGhpcy51bmJpbmRFdmVudHMoKSl9LHMucHJvdG90eXBlLnVuYmluZEV2ZW50cz1mdW5jdGlvbigpe3RoaXMuaW1nLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcyksdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsdGhpcyl9LHMucHJvdG90eXBlLmNvbmZpcm09ZnVuY3Rpb24oZSx0KXt0aGlzLmlzTG9hZGVkPWUsdGhpcy5lbWl0RXZlbnQoXCJwcm9ncmVzc1wiLFt0aGlzLHRoaXMuZWxlbWVudCx0XSl9LG8ubWFrZUpRdWVyeVBsdWdpbj1mdW5jdGlvbih0KXt0PXR8fGUualF1ZXJ5LHQmJihoPXQsaC5mbi5pbWFnZXNMb2FkZWQ9ZnVuY3Rpb24oZSx0KXt2YXIgaT1uZXcgbyh0aGlzLGUsdCk7cmV0dXJuIGkuanFEZWZlcnJlZC5wcm9taXNlKGgodGhpcykpfSl9LG8ubWFrZUpRdWVyeVBsdWdpbigpLG99KTtcclxuXHJcbi8qIHZyMzYwICovXHJcbi8vIHZhciB2cjM2MEltZ1NyYyA9ICcvQXV0by9TQU5UQUZFL3ZhcmlhbnQvQWN0aXZlLyc7XHJcbnZhciBwcm9ncmVzc1RpbWVyO1xyXG52YXIgdnIzNjBJbWdTcmMgPSAnLi4vLi4vLi4vQXV0by9pMTAvJztcclxudmFyIGNvbG9ycyA9IFsnUG9sYXJfV2hpdGUnLCAnQ2hhbXBpb25fQmx1ZSddO1xyXG52YXIgdnJJbmZvID0ge1xyXG4gICAgLy8gbW9kZWw6ICdTMVc3TDZBMUdERDQ3MycsXHJcbiAgICBkaXJlY3Rpb246IDAsXHJcbiAgICBzdGFydFg6IDAsXHJcbiAgICBzdGFydFk6IDAsXHJcbiAgICBiZWZvcmVYOiAwLFxyXG4gICAgYmVmb3JlWTogMCxcclxuICAgIGN1cnJlbnRDb2xvcjogY29sb3JzWzBdXHJcbn07XHJcbnZhciBwdXNoU2l6ZSA9IDEwO1xyXG5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgdnJJbml0KCk7XHJcbiAgICBsYXlvdXRTaXplKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdnJJbml0KCkge1xyXG4gICAgICAgIHZhciBpc0xvYWRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgJHRhcmdldCA9ICQoJy52ci1jYXItd3JhcCcpO1xyXG4gICAgICAgIHZhciAkdGFyZ2V0VCA9ICR0YXJnZXQ7XHJcbiAgICAgICAgdmFyIG1vdmVUeXBlID0gLTE7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGh0RGVmYXVsdE9wdGlvbiA9IHtcclxuICAgICAgICAgICAgbW92ZVRocmVzaG9sZDogNixcclxuICAgICAgICAgICAgc2xvcGVUaHJlc2hvbGQ6IDUwLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1N0YXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGlzTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBuVlNsb3BlID0gMDtcclxuICAgICAgICB2YXIgbkhTbG9wZSA9IDA7XHJcbiAgICAgICAgdmFyIGJTZXRTbG9wZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBpbnRlcnZhbCA9IGludGVydmFsID8gMTAgOiA1O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRNb3ZlSW5mbygpIHtcclxuICAgICAgICAgICAgdnJJbmZvLmRpcmVjdGlvbiA9IDY7XHJcbiAgICAgICAgICAgIHZySW5mby5jb2xvciA9IGNvbG9yc1swXTtcclxuICAgICAgICAgICAgdnJJbmZvLnN0YXJ0WCA9IDA7XHJcbiAgICAgICAgICAgIHZySW5mby5zdGFydFkgPSAwO1xyXG4gICAgICAgICAgICB2ckluZm8uYmVmb3JlWCA9IDA7XHJcbiAgICAgICAgICAgIHZySW5mby5iZWZvcmVZID0gMDtcclxuICAgICAgICAgICAgdnJJbmZvLmN1cnJlbnRDb2xvciA9IHZySW5mby5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgIC8vIHB1c2hEaXJlY3Rpb24gPSAyNiArIHZySW5mby5kaXJlY3Rpb25cclxuXHJcbiAgICAgICAgICAgIC8vIGlmIChwdXNoRGlyZWN0aW9uID4gMzYpIHtcclxuICAgICAgICAgICAgLy8gICAgIHB1c2hEaXJlY3Rpb24gPSB2ckluZm8uZGlyZWN0aW9uIC0gMzY7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAocHVzaERpcmVjdGlvbiA8IHB1c2hTaXplKSB2ckluZm8uZGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICB0ID0gdnJJbmZvLmRpcmVjdGlvbjtcclxuICAgICAgICAgICAgaWYgKHQgPCAxMCkgdCA9ICcwJyArIHQ7XHJcblxyXG4gICAgICAgICAgICAkdGFyZ2V0LmZpbmQoJy5zZXF1ZW5jZScpLnJlbW92ZUNsYXNzKCdvbicpLmVxKHZySW5mby5kaXJlY3Rpb24pLmFkZENsYXNzKCdvbicpO1xyXG4gICAgICAgICAgICAkdGFyZ2V0LmZpbmQoJy5zZXF1ZW5jZScpLmVxKHZySW5mby5kaXJlY3Rpb24pLmFwcGVuZCgnPGltZyBzcmM9XCInKyB2cjM2MEltZ1NyYyArIHZySW5mby5jb2xvciArJy8nKyB2ckluZm8uY29sb3IgKyAnXycgKyB0ICsnLnBuZ1wiPicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBpbml0XHJcbiAgICAgICAgaW5pdE1vdmVJbmZvKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJHRhcmdldC5vbigndG91Y2hzdGFydCBtb3VzZWRvd24nLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09ICdtb3VzZWRvd24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG1SZXN0KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgaHRJbmZvID0gZ2V0TW92ZUluZm8oZSk7XHJcblxyXG4gICAgICAgICAgICBpc1N0YXJ0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIG5TdGFydFggPSBodEluZm8ublg7XHJcbiAgICAgICAgICAgIG5TdGFydFkgPSBodEluZm8ublk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZHggPSB2ckluZm8uZGlyZWN0aW9uICsxO1xyXG4gICAgICAgICAgICAvLyBpZHggPSBwdXNoRGlyZWN0aW9uICsxO1xyXG5cclxuICAgICAgICAgICAgdnJJbmZvLnN0YXJ0WCA9IGh0SW5mby5uWDtcclxuICAgICAgICAgICAgdnJJbmZvLnN0YXJ0WSA9IGh0SW5mby5uWTtcclxuXHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2codnJJbmZvKVxyXG4gICAgICAgICAgICAkdGFyZ2V0LmFkZENsYXNzKCdlLXN0YXJ0Jyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKCFpc01vYmlsZSkge1xyXG4gICAgICAgICAgICAkdGFyZ2V0VCA9ICR3aW5kb3c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkdGFyZ2V0VC5vbigndG91Y2htb3ZlIG1vdXNlbW92ZScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICBpZighaXNTdGFydCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlzTW92ZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB2YXIgaHRJbmZvID0gZ2V0TW92ZUluZm8oZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2ckluZm8uYmVmb3JlWCA9IGh0SW5mby5uWDtcclxuICAgICAgICAgICAgdnJJbmZvLmJlZm9yZVkgPSBodEluZm8ublk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAobW92ZVR5cGUgPCAwIHx8IG1vdmVUeXBlID09IDMgfHwgbW92ZVR5cGUgPT0gNCkge1xyXG4gICAgICAgICAgICAgICAgbW92ZVR5cGUgPSBnZXRNb3ZlVHlwZShodEluZm8ublgsIGh0SW5mby5uWSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtb3ZlVHlwZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodnJJbmZvLmJlZm9yZVggLSBpbnRlcnZhbCA+IHZySW5mby5zdGFydFgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZHgrKztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gMzYpIGlkeCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdnJJbmZvLnN0YXJ0WCA9IHZySW5mby5iZWZvcmVYO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2ckluZm8uYmVmb3JlWCArIGludGVydmFsIDwgdnJJbmZvLnN0YXJ0WCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkeC0tO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHggPCAxKSBpZHggPSAzNjtcclxuICAgICAgICAgICAgICAgICAgICB2ckluZm8uc3RhcnRYID0gdnJJbmZvLmJlZm9yZVg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2ckluZm8uZGlyZWN0aW9uID0gaWR4IC0xO1xyXG4gICAgICAgICAgICAgICAgJHRhcmdldC5maW5kKCcuc2VxdWVuY2UnKS5yZW1vdmVDbGFzcygnb24nKS5lcSh2ckluZm8uZGlyZWN0aW9uKS5hZGRDbGFzcygnb24nKTtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobW92ZVR5cGUgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZ2V0TW92ZVR5cGUubkRpcyA8IGh0RGVmYXVsdE9wdGlvbi5tb3ZlVGhyZXNob2xkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47IFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkdGFyZ2V0LmFkZENsYXNzKCdlLXN0YXJ0Jyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJHRhcmdldFQub24oJ3RvdWNoZW5kIG1vdXNldXAnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09ICdtb3VzZXVwJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtUmVzdCgpO1xyXG5cclxuICAgICAgICAgICAgJHRhcmdldC5yZW1vdmVDbGFzcygnZS1zdGFydCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBtUmVzdCgpe1xyXG4gICAgICAgICAgICBpc1N0YXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlzTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtb3ZlVHlwZSA9IC0xO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0U2xvcGUoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWJTZXRTbG9wZSkge1xyXG4gICAgICAgICAgICAgICAgbkhTbG9wZSA9ICgod2luZG93LmlubmVySGVpZ2h0LzIpIC8gd2luZG93LmlubmVyV2lkdGgpLnRvRml4ZWQoMikgKiAxO1xyXG4gICAgICAgICAgICAgICAgblZTbG9wZSA9ICh3aW5kb3cuaW5uZXJIZWlnaHQgLyAod2luZG93LmlubmVyV2lkdGgvMikpLnRvRml4ZWQoMikgKiAxO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5IU2xvcGUgOiBuSFNsb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgIG5WU2xvcGUgOiBuVlNsb3BlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TW92ZUluZm8oZSkge1xyXG4gICAgICAgICAgICB2YXIgeCA9IGlzTW9iaWxlID8gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVggOiBlLm9mZnNldFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gaXNNb2JpbGUgPyBlLm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWSA6IGUub2Zmc2V0WTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBuWCA6IHgsXHJcbiAgICAgICAgICAgICAgICBuWSA6IHlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TW92ZVR5cGUoeCwgeSkge1xyXG4gICAgICAgICAgICB2YXIgblR5cGUgPSBtb3ZlVHlwZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBuWCA9IE1hdGguYWJzKG5TdGFydFggLSB4KTtcclxuICAgICAgICAgICAgdmFyIG5ZID0gTWF0aC5hYnMoblN0YXJ0WSAtIHkpO1xyXG4gICAgICAgICAgICB2YXIgbkRpcyA9IG5YICsgblk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoaHREZWZhdWx0T3B0aW9uLnNsb3BlVGhyZXNob2xkIDw9IG5EaXMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuU2xvcGUgPSBwYXJzZUZsb2F0KChuWS9uWCkudG9GaXhlZCgyKSwxMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoblNsb3BlIDw9IHNldFNsb3BlKCkubkhTbG9wZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgblR5cGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoblNsb3BlID49IHNldFNsb3BlKCkublZTbG9wZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgblR5cGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgblR5cGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgfSAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuVHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgJCgnLmJ0bi12cjM2MCcpLm9uKCdjbGljaycsIHZyMzYwKTtcclxuICAgICAgICAkKCcuYnRuLWxlZnQtcHJldiwgLmJ0bi1yaWdodC1uZXh0Jykub24oJ2NsaWNrJywgY2FyTW92ZSk7XHJcbiAgICAgICAgJCgnLmV4dGVyaW9yLWNvbG9yLWNoaXAnKS5vbignY2xpY2snLCAnLmNvbG9yLXNlbGVjdCcsIGNvbG9yU2VsZWN0KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdnIzNjAoKSB7XHJcbiAgICAgICAgICAgIGltYWdlc1Byb2dyZXNzKHZySW5mby5tb2RlbCwgdnJJbmZvLmRpcmVjdGlvbiwgdnJJbmZvLmN1cnJlbnRDb2xvciwgJ2J0bi12cjM2MCcpO1xyXG4gICAgICAgICAgICAkKCcudnIzNjAtd3JhcCcpLmFkZENsYXNzKCdpcy1sb2FkaW5nJyk7XHJcbiAgICAgICAgICAgICQodGhpcykuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FyTW92ZSgpIHtcclxuICAgICAgICAgICAgaWYgKCFpc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYnRuLXByZXYnKSkge1xyXG4gICAgICAgICAgICAgICAgaWR4ID0gdnJJbmZvLmRpcmVjdGlvbiArMTtcclxuICAgICAgICAgICAgICAgIGlkeC0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkeCA8IDEpIGlkeCA9IDM2O1xyXG4gICAgICAgICAgICAgICAgdnJJbmZvLmRpcmVjdGlvbiA9IGlkeCAtMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2J0bi1uZXh0JykpIHtcclxuICAgICAgICAgICAgICAgIGlkeCA9IHZySW5mby5kaXJlY3Rpb24gKzE7XHJcbiAgICAgICAgICAgICAgICBpZHgrKztcclxuICAgICAgICAgICAgICAgIGlmIChpZHggPiAzNikgaWR4ID0gMTtcclxuICAgICAgICAgICAgICAgIHZySW5mby5kaXJlY3Rpb24gPSBpZHggLTE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICQoJy52ci1jYXItd3JhcCcpLmZpbmQoJy5zZXF1ZW5jZScpLnJlbW92ZUNsYXNzKCdvbicpLmVxKHZySW5mby5kaXJlY3Rpb24pLmFkZENsYXNzKCdvbicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29sb3JTZWxlY3QoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBpZHggPSAkdGhpcy5wYXJlbnQoKS5pbmRleCgpO1xyXG4gICAgICAgICAgICB2YXIgJHZyMzYwID0gJCgnLnZyLWNhci13cmFwJyk7XHJcbiAgICAgICAgICAgIHZhciAkbm9WcjM2MCA9ICQoJy52ci1jYXItbm8taW1nJyk7XHJcbiAgICAgICAgICAgIHZhciAkYnRuVnIzNjAgPSAkKCcuYnRuLXZyMzYwJyk7XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKCR0aGlzLmhhc0NsYXNzKCduby12cjM2MCcpKSB7XHJcbiAgICAgICAgICAgICAgICAkdnIzNjAuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgJG5vVnIzNjAuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgJGJ0blZyMzYwLmhpZGUoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICR2cjM2MC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAkbm9WcjM2MC5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHZySW5mby5jdXJyZW50Q29sb3IgPSBjb2xvcnNbaWR4XTtcclxuICAgICAgICAgICAgICAgIGltYWdlc1Byb2dyZXNzKHZySW5mby5tb2RlbCwgdnJJbmZvLmRpcmVjdGlvbiwgY29sb3JzW2lkeF0sICdidG4tY29sb3InKTtcclxuICAgICAgICAgICAgICAgICR0aGlzLnBhcmVudCgpLmFkZENsYXNzKCdpcy1hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcudnIzNjAtd3JhcCcpLmFkZENsYXNzKCdpcy1sb2FkaW5nJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRidG5WcjM2MC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKHZySW5mbylcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gaW1hZ2VzUHJvZ3Jlc3MobSwgaSwgYywgdikge1xyXG4gICAgICAgICAgICB2YXIgJHRhcmdldCA9ICQoJy52cjM2MC13cmFwJyk7XHJcbiAgICAgICAgICAgIHZhciAkc2VxdWVuY2UgPSAkdGFyZ2V0LmZpbmQoJy5zZXF1ZW5jZScpO1xyXG4gICAgICAgICAgICB2YXIgJHByb2dyZXNzQmFyID0gJHRhcmdldC5maW5kKCcucHJvZ3Jlc3MgPiAuYmFyJyk7XHJcbiAgICAgICAgICAgIHZhciAkcHJvZ3Jlc3NUZXh0ID0gJHRhcmdldC5maW5kKCcucHJvZ3Jlc3MgPiAuY291bnQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBpZHggPSBpO1xyXG4gICAgICAgICAgICB2YXIgdG90YWwgPSAzNjtcclxuICAgICAgICBcclxuICAgICAgICAgICAgaW5pdFByb2dyZXNzKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodiA9PSAnYnRuLXZyMzYwJykge1xyXG4gICAgICAgICAgICAgICAgaXNMb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHRhcmdldC5maW5kKCcuc2VxdWVuY2UnKS5lbXB0eSgpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPD10b3RhbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgPCAxMCkgdCA9ICcwJyArIHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICR0YXJnZXQuZmluZCgnLnNlcXVlbmNlW2RhdGEtc2VxdWVuY2U9JysgaSArJ10nKS5hcHBlbmQoJzxpbWcgc3JjPVwiJyArIHZyMzYwSW1nU3JjICsgYyArJy8nKyBjICsgJ18nICsgdCArJy5wbmdcIiBhbHQ9XCJcIj4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodiA9PSAnYnRuLWNvbG9yJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPD10b3RhbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDEwKSB0ID0gJzAnICsgdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXQuZmluZCgnLnNlcXVlbmNlW2RhdGEtc2VxdWVuY2U9JysgaSArJ10nKS5maW5kKCdpbWcnKS5hdHRyKCdzcmMnLCB2cjM2MEltZ1NyYyArIGMgKycvJysgYyArICdfJyArIHQgKycucG5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDEwKSB0ID0gJzAnICsgdDtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LmZpbmQoJy5zZXF1ZW5jZVtkYXRhLXNlcXVlbmNlPScrIGkgKyddJykuZmluZCgnaW1nJykuYXR0cignc3JjJywgdnIzNjBJbWdTcmMgKyBjICsnLycrIGMgKyAnXycgKyB0ICsnLnBuZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIWlzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciAkdGFyZ2V0ID0gJCgnLnZyMzYwLXdyYXAnKTtcclxuICAgICAgICAgICAgdmFyICRpbWdMb2FkID0gaW1hZ2VzTG9hZGVkKCcudnIzNjAtd3JhcCcpLFxyXG4gICAgICAgICAgICAgICAgaW1nVG90YWwgPSAkaW1nTG9hZC5pbWFnZXMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgaW1nTG9hZGVkID0gMCxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NUaW1lcik7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc1RpbWVyID0gc2V0SW50ZXJ2YWwodXBkYXRlUHJvZ3Jlc3MsIDEwMDAgLyA2MCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRpbWdMb2FkLm9uKCdwcm9ncmVzcycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1nTG9hZGVkKys7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3MoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gKGltZ0xvYWRlZCAvIGltZ1RvdGFsKSAqIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ICs9ICh0YXJnZXQgLSBjdXJyZW50KSAqIDAuMTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudCA+PSA5OS45KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IDEwMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudCA+PSAxMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRwcm9ncmVzc0Jhci5hZGQoJHByb2dyZXNzVGV4dCkuc3RvcCgpLmFuaW1hdGUoeyBvcGFjaXR5OjAgfSwgMCwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZyMzYwLXdyYXAnKS5yZW1vdmVDbGFzcygnaXMtbG9hZGluZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcudnIzNjAtd3JhcCcpLmFkZENsYXNzKCdwcm9ncmVzcy1jb21wbGV0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcudnIzNjAtd3JhcCcpLmZpbmQoJy52ci1jYXItd3JhcCcpLmFkZENsYXNzKCdtb3ZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHByb2dyZXNzQmFyLmNzcyh7IHdpZHRoOiBjdXJyZW50ICsgJyUnIH0pO1xyXG4gICAgICAgICAgICAgICAgJHByb2dyZXNzVGV4dC5jc3MoJ29wYWNpdHknLCAnMScpLnRleHQoIE1hdGguZmxvb3IoY3VycmVudCkgKyAgJyUnICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAgICAgZnVuY3Rpb24gaW5pdFByb2dyZXNzKCkge1xyXG4gICAgICAgICAgICAgICAgJHRhcmdldC5yZW1vdmVDbGFzcygncHJvZ3Jlc3MtY29tcGxldGUnKTtcclxuICAgICAgICAgICAgICAgICR0YXJnZXQuZmluZCgnLnZyLWNhci13cmFwJykucmVtb3ZlQ2xhc3MoJ21vdmUnKTtcclxuICAgICAgICAgICAgICAgICRwcm9ncmVzc0Jhci5jc3Moeyd3aWR0aCc6ICcwJScsICdvcGFjaXR5JzogJzEnfSk7XHJcbiAgICAgICAgICAgICAgICAkcHJvZ3Jlc3NUZXh0LmNzcygnb3BhY2l0eScsICcwJykuaHRtbCgnMCUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7Il0sImZpbGUiOiJmcm9udC9hc3NldHMvanMvdnIzNjAuanMifQ==
